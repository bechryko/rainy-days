import{a as $i,c as Yi,q as Zi,r as Ki}from"./chunk-DXRQAALT.js";import{$ as U,$a as X,A as Ie,Aa as gi,Ab as Si,B as ii,Ba as q,Bc as Qi,C as ht,Ca as _i,D as ni,Da as bt,Db as je,E as oi,Ea as et,Eb as Ii,F as ai,Fa as tt,Fb as Ai,Ga as u,H as ri,Ha as p,Ia as V,Ib as Di,J as si,Ja as bi,Jb as Nt,K as ut,Ka as G,L as It,La as xi,M as Ke,Ma as S,Na as A,O as C,Oa as Fe,Ob as Te,Pa as Ve,Pb as it,Q as ci,Qa as ki,R as O,Rb as Lt,S as w,Sa as ke,Sb as Ri,T as li,Ta as Ce,Tb as Pi,U as di,Ua as ve,Ub as Bt,W as pt,Wa as xt,Wb as Ni,X as mi,Xa as kt,Xb as Gt,Y as At,Ya as He,Z as ft,Za as x,Zb as Li,_ as Dt,_a as le,a as W,aa as be,ac as vt,b as me,bb as Ci,bc as Bi,ca as xe,cb as Ct,cc as Gi,d as he,da as gt,db as vi,dc as Ui,e as Rn,eb as yi,fa as hi,fb as ue,g as Ue,gb as pe,ha as b,hc as Ut,i as se,ia as ui,j as Se,jb as ze,jc as Fi,kc as Vi,lb as ye,m as ti,mb as Ti,mc as Hi,na as _t,nc as zi,o as ce,ob as Z,pa as E,pb as Ei,qa as Rt,qb as Mi,qc as Ae,ra as Qe,rc as Wi,s as mt,sa as pi,sb as Oi,ta as Pt,tb as wi,tc as qe,ua as F,v as te,vb as We,vc as ji,wa as Je,wc as Ft,xa as I,xc as qi,y as St,ya as fi,za as P,zc as Xi}from"./chunk-MXH2ASGT.js";var on=he((nn,zt)=>{"use strict";(function(i,o,e){function t(a){var l=this,h=s();l.next=function(){var d=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=d-(l.c=d|0)},l.c=1,l.s0=h(" "),l.s1=h(" "),l.s2=h(" "),l.s0-=h(a),l.s0<0&&(l.s0+=1),l.s1-=h(a),l.s1<0&&(l.s1+=1),l.s2-=h(a),l.s2<0&&(l.s2+=1),h=null}function n(a,l){return l.c=a.c,l.s0=a.s0,l.s1=a.s1,l.s2=a.s2,l}function r(a,l){var h=new t(a),d=l&&l.state,m=h.next;return m.int32=function(){return h.next()*4294967296|0},m.double=function(){return m()+(m()*2097152|0)*11102230246251565e-32},m.quick=m,d&&(typeof d=="object"&&n(d,h),m.state=function(){return n(h,{})}),m}function s(){var a=4022871197,l=function(h){h=String(h);for(var d=0;d<h.length;d++){a+=h.charCodeAt(d);var m=.02519603282416938*a;a=m>>>0,m-=a,m*=a,a=m>>>0,m-=a,a+=m*4294967296}return(a>>>0)*23283064365386963e-26};return l}o&&o.exports?o.exports=r:e&&e.amd?e(function(){return r}):this.alea=r})(nn,typeof zt=="object"&&zt,typeof define=="function"&&define)});var rn=he((an,Wt)=>{"use strict";(function(i,o,e){function t(s){var a=this,l="";a.x=0,a.y=0,a.z=0,a.w=0,a.next=function(){var d=a.x^a.x<<11;return a.x=a.y,a.y=a.z,a.z=a.w,a.w^=a.w>>>19^d^d>>>8},s===(s|0)?a.x=s:l+=s;for(var h=0;h<l.length+64;h++)a.x^=l.charCodeAt(h)|0,a.next()}function n(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a}function r(s,a){var l=new t(s),h=a&&a.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var m=l.next()>>>11,f=(l.next()>>>0)/4294967296,g=(m+f)/(1<<21);while(g===0);return g},d.int32=l.next,d.quick=d,h&&(typeof h=="object"&&n(h,l),d.state=function(){return n(l,{})}),d}o&&o.exports?o.exports=r:e&&e.amd?e(function(){return r}):this.xor128=r})(an,typeof Wt=="object"&&Wt,typeof define=="function"&&define)});var cn=he((sn,jt)=>{"use strict";(function(i,o,e){function t(s){var a=this,l="";a.next=function(){var d=a.x^a.x>>>2;return a.x=a.y,a.y=a.z,a.z=a.w,a.w=a.v,(a.d=a.d+362437|0)+(a.v=a.v^a.v<<4^(d^d<<1))|0},a.x=0,a.y=0,a.z=0,a.w=0,a.v=0,s===(s|0)?a.x=s:l+=s;for(var h=0;h<l.length+64;h++)a.x^=l.charCodeAt(h)|0,h==l.length&&(a.d=a.x<<10^a.x>>>4),a.next()}function n(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a.v=s.v,a.d=s.d,a}function r(s,a){var l=new t(s),h=a&&a.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var m=l.next()>>>11,f=(l.next()>>>0)/4294967296,g=(m+f)/(1<<21);while(g===0);return g},d.int32=l.next,d.quick=d,h&&(typeof h=="object"&&n(h,l),d.state=function(){return n(l,{})}),d}o&&o.exports?o.exports=r:e&&e.amd?e(function(){return r}):this.xorwow=r})(sn,typeof jt=="object"&&jt,typeof define=="function"&&define)});var dn=he((ln,qt)=>{"use strict";(function(i,o,e){function t(s){var a=this;a.next=function(){var h=a.x,d=a.i,m,f,g;return m=h[d],m^=m>>>7,f=m^m<<24,m=h[d+1&7],f^=m^m>>>10,m=h[d+3&7],f^=m^m>>>3,m=h[d+4&7],f^=m^m<<7,m=h[d+7&7],m=m^m<<13,f^=m^m<<9,h[d]=f,a.i=d+1&7,f};function l(h,d){var m,f,g=[];if(d===(d|0))f=g[0]=d;else for(d=""+d,m=0;m<d.length;++m)g[m&7]=g[m&7]<<15^d.charCodeAt(m)+g[m+1&7]<<13;for(;g.length<8;)g.push(0);for(m=0;m<8&&g[m]===0;++m);for(m==8?f=g[7]=-1:f=g[m],h.x=g,h.i=0,m=256;m>0;--m)h.next()}l(a,s)}function n(s,a){return a.x=s.x.slice(),a.i=s.i,a}function r(s,a){s==null&&(s=+new Date);var l=new t(s),h=a&&a.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var m=l.next()>>>11,f=(l.next()>>>0)/4294967296,g=(m+f)/(1<<21);while(g===0);return g},d.int32=l.next,d.quick=d,h&&(h.x&&n(h,l),d.state=function(){return n(l,{})}),d}o&&o.exports?o.exports=r:e&&e.amd?e(function(){return r}):this.xorshift7=r})(ln,typeof qt=="object"&&qt,typeof define=="function"&&define)});var hn=he((mn,Xt)=>{"use strict";(function(i,o,e){function t(s){var a=this;a.next=function(){var h=a.w,d=a.X,m=a.i,f,g;return a.w=h=h+1640531527|0,g=d[m+34&127],f=d[m=m+1&127],g^=g<<13,f^=f<<17,g^=g>>>15,f^=f>>>12,g=d[m]=g^f,a.i=m,g+(h^h>>>16)|0};function l(h,d){var m,f,g,Y,ge,ae=[],$e=128;for(d===(d|0)?(f=d,d=null):(d=d+"\0",f=0,$e=Math.max($e,d.length)),g=0,Y=-32;Y<$e;++Y)d&&(f^=d.charCodeAt((Y+32)%d.length)),Y===0&&(ge=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,Y>=0&&(ge=ge+1640531527|0,m=ae[Y&127]^=f+ge,g=m==0?g+1:0);for(g>=128&&(ae[(d&&d.length||0)&127]=-1),g=127,Y=4*128;Y>0;--Y)f=ae[g+34&127],m=ae[g=g+1&127],f^=f<<13,m^=m<<17,f^=f>>>15,m^=m>>>12,ae[g]=f^m;h.w=ge,h.X=ae,h.i=g}l(a,s)}function n(s,a){return a.i=s.i,a.w=s.w,a.X=s.X.slice(),a}function r(s,a){s==null&&(s=+new Date);var l=new t(s),h=a&&a.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var m=l.next()>>>11,f=(l.next()>>>0)/4294967296,g=(m+f)/(1<<21);while(g===0);return g},d.int32=l.next,d.quick=d,h&&(h.X&&n(h,l),d.state=function(){return n(l,{})}),d}o&&o.exports?o.exports=r:e&&e.amd?e(function(){return r}):this.xor4096=r})(mn,typeof Xt=="object"&&Xt,typeof define=="function"&&define)});var pn=he((un,$t)=>{"use strict";(function(i,o,e){function t(s){var a=this,l="";a.next=function(){var d=a.b,m=a.c,f=a.d,g=a.a;return d=d<<25^d>>>7^m,m=m-f|0,f=f<<24^f>>>8^g,g=g-d|0,a.b=d=d<<20^d>>>12^m,a.c=m=m-f|0,a.d=f<<16^m>>>16^g,a.a=g-d|0},a.a=0,a.b=0,a.c=-1640531527,a.d=1367130551,s===Math.floor(s)?(a.a=s/4294967296|0,a.b=s|0):l+=s;for(var h=0;h<l.length+20;h++)a.b^=l.charCodeAt(h)|0,a.next()}function n(s,a){return a.a=s.a,a.b=s.b,a.c=s.c,a.d=s.d,a}function r(s,a){var l=new t(s),h=a&&a.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var m=l.next()>>>11,f=(l.next()>>>0)/4294967296,g=(m+f)/(1<<21);while(g===0);return g},d.int32=l.next,d.quick=d,h&&(typeof h=="object"&&n(h,l),d.state=function(){return n(l,{})}),d}o&&o.exports?o.exports=r:e&&e.amd?e(function(){return r}):this.tychei=r})(un,typeof $t=="object"&&$t,typeof define=="function"&&define)});var fn=he(()=>{"use strict"});var _n=he((gn,Mt)=>{"use strict";(function(i,o,e){var t=256,n=6,r=52,s="random",a=e.pow(t,n),l=e.pow(2,r),h=l*2,d=t-1,m;function f(T,M,j){var B=[];M=M==!0?{entropy:!0}:M||{};var R=ae(ge(M.entropy?[T,Ye(o)]:T??$e(),3),B),Q=new g(B),ee=function(){for(var J=Q.g(n),de=a,re=0;J<l;)J=(J+re)*t,de*=t,re=Q.g(1);for(;J>=h;)J/=2,de/=2,re>>>=1;return(J+re)/de};return ee.int32=function(){return Q.g(4)|0},ee.quick=function(){return Q.g(4)/4294967296},ee.double=ee,ae(Ye(Q.S),o),(M.pass||j||function(J,de,re,_e){return _e&&(_e.S&&Y(_e,Q),J.state=function(){return Y(Q,{})}),re?(e[s]=J,de):J})(ee,R,"global"in M?M.global:this==e,M.state)}function g(T){var M,j=T.length,B=this,R=0,Q=B.i=B.j=0,ee=B.S=[];for(j||(T=[j++]);R<t;)ee[R]=R++;for(R=0;R<t;R++)ee[R]=ee[Q=d&Q+T[R%j]+(M=ee[R])],ee[Q]=M;(B.g=function(J){for(var de,re=0,_e=B.i,dt=B.j,Ze=B.S;J--;)de=Ze[_e=d&_e+1],re=re*t+Ze[d&(Ze[_e]=Ze[dt=d&dt+de])+(Ze[dt]=de)];return B.i=_e,B.j=dt,re})(t)}function Y(T,M){return M.i=T.i,M.j=T.j,M.S=T.S.slice(),M}function ge(T,M){var j=[],B=typeof T,R;if(M&&B=="object")for(R in T)try{j.push(ge(T[R],M-1))}catch{}return j.length?j:B=="string"?T:T+"\0"}function ae(T,M){for(var j=T+"",B,R=0;R<j.length;)M[d&R]=d&(B^=M[d&R]*19)+j.charCodeAt(R++);return Ye(M)}function $e(){try{var T;return m&&(T=m.randomBytes)?T=T(t):(T=new Uint8Array(t),(i.crypto||i.msCrypto).getRandomValues(T)),Ye(T)}catch{var M=i.navigator,j=M&&M.plugins;return[+new Date,i,j,i.screen,Ye(o)]}}function Ye(T){return String.fromCharCode.apply(0,T)}if(ae(e.random(),o),typeof Mt=="object"&&Mt.exports){Mt.exports=f;try{m=fn()}catch{}}else typeof define=="function"&&define.amd?define(function(){return f}):e["seed"+s]=f})(typeof self<"u"?self:gn,[],Math)});var xn=he((Cr,bn)=>{"use strict";var jn=on(),qn=rn(),Xn=cn(),$n=dn(),Yn=hn(),Zn=pn(),Le=_n();Le.alea=jn;Le.xor128=qn;Le.xorwow=Xn;Le.xorshift7=$n;Le.xor4096=Yn;Le.tychei=Zn;bn.exports=Le});var Ji={XSmall:"(max-width: 599.98px)",Small:"(min-width: 600px) and (max-width: 959.98px)",Medium:"(min-width: 960px) and (max-width: 1279.98px)",Large:"(min-width: 1280px) and (max-width: 1919.98px)",XLarge:"(min-width: 1920px)",Handset:"(max-width: 599.98px) and (orientation: portrait), (max-width: 959.98px) and (orientation: landscape)",Tablet:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait), (min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",Web:"(min-width: 840px) and (orientation: portrait), (min-width: 1280px) and (orientation: landscape)",HandsetPortrait:"(max-width: 599.98px) and (orientation: portrait)",TabletPortrait:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait)",WebPortrait:"(min-width: 840px) and (orientation: portrait)",HandsetLandscape:"(max-width: 959.98px) and (orientation: landscape)",TabletLandscape:"(min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",WebLandscape:"(min-width: 1280px) and (orientation: landscape)"};function Pn(i,o){if(i&1){let e=G();u(0,"div",1)(1,"button",2),S("click",function(){O(e);let n=A();return w(n.action())}),x(2),p()()}if(i&2){let e=A();b(2),X(" ",e.data.action," ")}}var Nn=["label"];function Ln(i,o){}var Bn=Math.pow(2,31)-1,nt=class{_overlayRef;instance;containerInstance;_afterDismissed=new se;_afterOpened=new se;_onAction=new se;_durationTimeoutId;_dismissedByAction=!1;constructor(o,e){this._overlayRef=e,this.containerInstance=o,o._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}dismissWithAction(){this._onAction.closed||(this._dismissedByAction=!0,this._onAction.next(),this._onAction.complete(),this.dismiss()),clearTimeout(this._durationTimeoutId)}closeWithAction(){this.dismissWithAction()}_dismissAfter(o){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(o,Bn))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._onAction.closed||this._onAction.complete(),this._afterDismissed.next({dismissedByAction:this._dismissedByAction}),this._afterDismissed.complete(),this._dismissedByAction=!1}afterDismissed(){return this._afterDismissed}afterOpened(){return this.containerInstance._onEnter}onAction(){return this._onAction}},en=new Ke("MatSnackBarData"),Xe=class{politeness="assertive";announcementMessage="";viewContainerRef;duration=0;panelClass;direction;data=null;horizontalPosition="center";verticalPosition="bottom"},Gn=(()=>{class i{static \u0275fac=function(t){return new(t||i)};static \u0275dir=Qe({type:i,selectors:[["","matSnackBarLabel",""]],hostAttrs:[1,"mat-mdc-snack-bar-label","mdc-snackbar__label"]})}return i})(),Un=(()=>{class i{static \u0275fac=function(t){return new(t||i)};static \u0275dir=Qe({type:i,selectors:[["","matSnackBarActions",""]],hostAttrs:[1,"mat-mdc-snack-bar-actions","mdc-snackbar__actions"]})}return i})(),Fn=(()=>{class i{static \u0275fac=function(t){return new(t||i)};static \u0275dir=Qe({type:i,selectors:[["","matSnackBarAction",""]],hostAttrs:[1,"mat-mdc-snack-bar-action","mdc-snackbar__action"]})}return i})(),Vn=(()=>{class i{snackBarRef=C(nt);data=C(en);constructor(){}action(){this.snackBarRef.dismissWithAction()}get hasAction(){return!!this.data.action}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=E({type:i,selectors:[["simple-snack-bar"]],hostAttrs:[1,"mat-mdc-simple-snack-bar"],exportAs:["matSnackBar"],decls:3,vars:2,consts:[["matSnackBarLabel",""],["matSnackBarActions",""],["mat-button","","matSnackBarAction","",3,"click"]],template:function(t,n){t&1&&(u(0,"div",0),x(1),p(),F(2,Pn,3,1,"div",1)),t&2&&(b(),X(" ",n.data.message,`
`),b(),q(n.hasAction?2:-1))},dependencies:[qe,Gn,Un,Fn],styles:[".mat-mdc-simple-snack-bar{display:flex}"],encapsulation:2,changeDetection:0})}return i})(),Vt="_mat-snack-bar-enter",Ht="_mat-snack-bar-exit",Hn=(()=>{class i extends Pi{_ngZone=C(ft);_elementRef=C(be);_changeDetectorRef=C(ze);_platform=C(Ai);_rendersRef;_animationsDisabled=C(gt,{optional:!0})==="NoopAnimations";snackBarConfig=C(Xe);_document=C(Mi);_trackedModals=new Set;_enterFallback;_exitFallback;_renders=new se;_announceDelay=150;_announceTimeoutId;_destroyed=!1;_portalOutlet;_onAnnounce=new se;_onExit=new se;_onEnter=new se;_animationState="void";_live;_label;_role;_liveElementId=C(vt).getId("mat-snack-bar-container-live-");constructor(){super();let e=this.snackBarConfig;e.politeness==="assertive"&&!e.announcementMessage?this._live="assertive":e.politeness==="off"?this._live="off":this._live="polite",this._platform.FIREFOX&&(this._live==="polite"&&(this._role="status"),this._live==="assertive"&&(this._role="alert")),this._rendersRef=hi(()=>this._renders.next(),{manualCleanup:!0})}attachComponentPortal(e){this._assertNotAttached();let t=this._portalOutlet.attachComponentPortal(e);return this._afterPortalAttached(),t}attachTemplatePortal(e){this._assertNotAttached();let t=this._portalOutlet.attachTemplatePortal(e);return this._afterPortalAttached(),t}attachDomPortal=e=>{this._assertNotAttached();let t=this._portalOutlet.attachDomPortal(e);return this._afterPortalAttached(),t};onAnimationEnd(e){e===Ht?this._completeExit():e===Vt&&(clearTimeout(this._enterFallback),this._ngZone.run(()=>{this._onEnter.next(),this._onEnter.complete()}))}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.markForCheck(),this._changeDetectorRef.detectChanges(),this._screenReaderAnnounce(),this._animationsDisabled?this._renders.pipe(St(1)).subscribe(()=>{this._ngZone.run(()=>queueMicrotask(()=>this.onAnimationEnd(Vt)))}):(clearTimeout(this._enterFallback),this._enterFallback=setTimeout(()=>{this._elementRef.nativeElement.classList.add("mat-snack-bar-fallback-visible"),this.onAnimationEnd(Vt)},200)))}exit(){return this._destroyed?ti(void 0):(this._ngZone.run(()=>{this._animationState="hidden",this._changeDetectorRef.markForCheck(),this._elementRef.nativeElement.setAttribute("mat-exit",""),clearTimeout(this._announceTimeoutId),this._animationsDisabled?this._renders.pipe(St(1)).subscribe(()=>{this._ngZone.run(()=>queueMicrotask(()=>this.onAnimationEnd(Ht)))}):(clearTimeout(this._exitFallback),this._exitFallback=setTimeout(()=>this.onAnimationEnd(Ht),200))}),this._onExit)}ngOnDestroy(){this._destroyed=!0,this._clearFromModals(),this._completeExit(),this._renders.complete(),this._rendersRef.destroy()}_completeExit(){clearTimeout(this._exitFallback),queueMicrotask(()=>{this._onExit.next(),this._onExit.complete()})}_afterPortalAttached(){let e=this._elementRef.nativeElement,t=this.snackBarConfig.panelClass;t&&(Array.isArray(t)?t.forEach(s=>e.classList.add(s)):e.classList.add(t)),this._exposeToModals();let n=this._label.nativeElement,r="mdc-snackbar__label";n.classList.toggle(r,!n.querySelector(`.${r}`))}_exposeToModals(){let e=this._liveElementId,t=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let n=0;n<t.length;n++){let r=t[n],s=r.getAttribute("aria-owns");this._trackedModals.add(r),s?s.indexOf(e)===-1&&r.setAttribute("aria-owns",s+" "+e):r.setAttribute("aria-owns",e)}}_clearFromModals(){this._trackedModals.forEach(e=>{let t=e.getAttribute("aria-owns");if(t){let n=t.replace(this._liveElementId,"").trim();n.length>0?e.setAttribute("aria-owns",n):e.removeAttribute("aria-owns")}}),this._trackedModals.clear()}_assertNotAttached(){this._portalOutlet.hasAttached()}_screenReaderAnnounce(){this._announceTimeoutId||this._ngZone.runOutsideAngular(()=>{this._announceTimeoutId=setTimeout(()=>{if(this._destroyed)return;let e=this._elementRef.nativeElement,t=e.querySelector("[aria-hidden]"),n=e.querySelector("[aria-live]");if(t&&n){let r=null;this._platform.isBrowser&&document.activeElement instanceof HTMLElement&&t.contains(document.activeElement)&&(r=document.activeElement),t.removeAttribute("aria-hidden"),n.appendChild(t),r?.focus(),this._onAnnounce.next(),this._onAnnounce.complete()}},this._announceDelay)})}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=E({type:i,selectors:[["mat-snack-bar-container"]],viewQuery:function(t,n){if(t&1&&(ke(Bt,7),ke(Nn,7)),t&2){let r;Ce(r=ve())&&(n._portalOutlet=r.first),Ce(r=ve())&&(n._label=r.first)}},hostAttrs:[1,"mdc-snackbar","mat-mdc-snack-bar-container"],hostVars:6,hostBindings:function(t,n){t&1&&S("animationend",function(s){return n.onAnimationEnd(s.animationName)})("animationcancel",function(s){return n.onAnimationEnd(s.animationName)}),t&2&&P("mat-snack-bar-container-enter",n._animationState==="visible")("mat-snack-bar-container-exit",n._animationState==="hidden")("mat-snack-bar-container-animations-enabled",!n._animationsDisabled)},features:[Pt],decls:6,vars:3,consts:[["label",""],[1,"mdc-snackbar__surface","mat-mdc-snackbar-surface"],[1,"mat-mdc-snack-bar-label"],["aria-hidden","true"],["cdkPortalOutlet",""]],template:function(t,n){t&1&&(u(0,"div",1)(1,"div",2,0)(3,"div",3),F(4,Ln,0,0,"ng-template",4),p(),V(5,"div"),p()()),t&2&&(b(5),Je("aria-live",n._live)("role",n._role)("id",n._liveElementId))},dependencies:[Bt],styles:["@keyframes _mat-snack-bar-enter{from{transform:scale(0.8);opacity:0}to{transform:scale(1);opacity:1}}@keyframes _mat-snack-bar-exit{from{opacity:1}to{opacity:0}}.mat-mdc-snack-bar-container{display:flex;align-items:center;justify-content:center;box-sizing:border-box;-webkit-tap-highlight-color:rgba(0,0,0,0);margin:8px}.mat-mdc-snack-bar-handset .mat-mdc-snack-bar-container{width:100vw}.mat-snack-bar-container-animations-enabled{opacity:0}.mat-snack-bar-container-animations-enabled.mat-snack-bar-fallback-visible{opacity:1}.mat-snack-bar-container-animations-enabled.mat-snack-bar-container-enter{animation:_mat-snack-bar-enter 150ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-snack-bar-container-animations-enabled.mat-snack-bar-container-exit{animation:_mat-snack-bar-exit 75ms cubic-bezier(0.4, 0, 1, 1) forwards}.mat-mdc-snackbar-surface{box-shadow:0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 6px 10px 0px rgba(0, 0, 0, 0.14), 0px 1px 18px 0px rgba(0, 0, 0, 0.12);display:flex;align-items:center;justify-content:flex-start;box-sizing:border-box;padding-left:0;padding-right:8px}[dir=rtl] .mat-mdc-snackbar-surface{padding-right:0;padding-left:8px}.mat-mdc-snack-bar-container .mat-mdc-snackbar-surface{min-width:344px;max-width:672px}.mat-mdc-snack-bar-handset .mat-mdc-snackbar-surface{width:100%;min-width:0}@media(forced-colors: active){.mat-mdc-snackbar-surface{outline:solid 1px}}.mat-mdc-snack-bar-container .mat-mdc-snackbar-surface{color:var(--mdc-snackbar-supporting-text-color, var(--mat-sys-inverse-on-surface));border-radius:var(--mdc-snackbar-container-shape, var(--mat-sys-corner-extra-small));background-color:var(--mdc-snackbar-container-color, var(--mat-sys-inverse-surface))}.mdc-snackbar__label{width:100%;flex-grow:1;box-sizing:border-box;margin:0;padding:14px 8px 14px 16px}[dir=rtl] .mdc-snackbar__label{padding-left:8px;padding-right:16px}.mat-mdc-snack-bar-container .mdc-snackbar__label{font-family:var(--mdc-snackbar-supporting-text-font, var(--mat-sys-body-medium-font));font-size:var(--mdc-snackbar-supporting-text-size, var(--mat-sys-body-medium-size));font-weight:var(--mdc-snackbar-supporting-text-weight, var(--mat-sys-body-medium-weight));line-height:var(--mdc-snackbar-supporting-text-line-height, var(--mat-sys-body-medium-line-height))}.mat-mdc-snack-bar-actions{display:flex;flex-shrink:0;align-items:center;box-sizing:border-box}.mat-mdc-snack-bar-handset,.mat-mdc-snack-bar-container,.mat-mdc-snack-bar-label{flex:1 1 auto}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled).mat-unthemed{color:var(--mat-snack-bar-button-color, var(--mat-sys-inverse-primary))}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled){--mat-text-button-state-layer-color:currentColor;--mat-text-button-ripple-color:currentColor}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled) .mat-ripple-element{opacity:.1}"],encapsulation:2})}return i})();function zn(){return new Xe}var Wn=new Ke("mat-snack-bar-default-options",{providedIn:"root",factory:zn}),tn=(()=>{class i{_overlay=C(Gi);_live=C(Li);_injector=C(pt);_breakpointObserver=C(Gt);_parentSnackBar=C(i,{optional:!0,skipSelf:!0});_defaultConfig=C(Wn);_snackBarRefAtThisLevel=null;simpleSnackBarComponent=Vn;snackBarContainerComponent=Hn;handsetCssClass="mat-mdc-snack-bar-handset";get _openedSnackBarRef(){let e=this._parentSnackBar;return e?e._openedSnackBarRef:this._snackBarRefAtThisLevel}set _openedSnackBarRef(e){this._parentSnackBar?this._parentSnackBar._openedSnackBarRef=e:this._snackBarRefAtThisLevel=e}constructor(){}openFromComponent(e,t){return this._attach(e,t)}openFromTemplate(e,t){return this._attach(e,t)}open(e,t="",n){let r=W(W({},this._defaultConfig),n);return r.data={message:e,action:t},r.announcementMessage===e&&(r.announcementMessage=void 0),this.openFromComponent(this.simpleSnackBarComponent,r)}dismiss(){this._openedSnackBarRef&&this._openedSnackBarRef.dismiss()}ngOnDestroy(){this._snackBarRefAtThisLevel&&this._snackBarRefAtThisLevel.dismiss()}_attachSnackBarContainer(e,t){let n=t&&t.viewContainerRef&&t.viewContainerRef.injector,r=pt.create({parent:n||this._injector,providers:[{provide:Xe,useValue:t}]}),s=new Lt(this.snackBarContainerComponent,t.viewContainerRef,r),a=e.attach(s);return a.instance.snackBarConfig=t,a.instance}_attach(e,t){let n=W(W(W({},new Xe),this._defaultConfig),t),r=this._createOverlay(n),s=this._attachSnackBarContainer(r,n),a=new nt(s,r);if(e instanceof ui){let l=new Ri(e,null,{$implicit:n.data,snackBarRef:a});a.instance=s.attachTemplatePortal(l)}else{let l=this._createInjector(n,a),h=new Lt(e,void 0,l),d=s.attachComponentPortal(h);a.instance=d.instance}return this._breakpointObserver.observe(Ji.HandsetPortrait).pipe(ai(r.detachments())).subscribe(l=>{r.overlayElement.classList.toggle(this.handsetCssClass,l.matches)}),n.announcementMessage&&s._onAnnounce.subscribe(()=>{this._live.announce(n.announcementMessage,n.politeness)}),this._animateSnackBar(a,n),this._openedSnackBarRef=a,this._openedSnackBarRef}_animateSnackBar(e,t){e.afterDismissed().subscribe(()=>{this._openedSnackBarRef==e&&(this._openedSnackBarRef=null),t.announcementMessage&&this._live.clear()}),t.duration&&t.duration>0&&e.afterOpened().subscribe(()=>e._dismissAfter(t.duration)),this._openedSnackBarRef?(this._openedSnackBarRef.afterDismissed().subscribe(()=>{e.containerInstance.enter()}),this._openedSnackBarRef.dismiss()):e.containerInstance.enter()}_createOverlay(e){let t=new Bi;t.direction=e.direction;let n=this._overlay.position().global(),r=e.direction==="rtl",s=e.horizontalPosition==="left"||e.horizontalPosition==="start"&&!r||e.horizontalPosition==="end"&&r,a=!s&&e.horizontalPosition!=="center";return s?n.left("0"):a?n.right("0"):n.centerHorizontally(),e.verticalPosition==="top"?n.top("0"):n.bottom("0"),t.positionStrategy=n,this._overlay.create(t)}_createInjector(e,t){let n=e&&e.viewContainerRef&&e.viewContainerRef.injector;return pt.create({parent:n||this._injector,providers:[{provide:nt,useValue:t},{provide:en,useValue:e.data}]})}static \u0275fac=function(t){return new(t||i)};static \u0275prov=ut({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var ie=class{constructor(o){this.tile=o}isOccupyingFor(o){return!1}onCarMove(o){}};var c=(()=>{class i{static{this.ROW_COUNT=15}static{this.COLUMN_COUNT=30}static unit(e=1){return this.size*e}static resize(){this.size=Ee.getMaxTileSize(this.ROW_COUNT,this.COLUMN_COUNT)}}return i})();var H=function(i){return i[i.UP=0]="UP",i[i.RIGHT=1]="RIGHT",i[i.DOWN=2]="DOWN",i[i.LEFT=3]="LEFT",i}(H||{});var Me=(()=>{class i{static{this.pool=[]}static{this.SIZE_TILE_RATIO=.25}static{this.COLLISION_DISTANCE=.2}static{this.OFFROAD_SPEED_MULTIPLIER=.25}static get SIZE(){return c.unit(this.SIZE_TILE_RATIO)}static tickAll(e,t){this.pool.forEach(n=>n.tick(e,t)),this.pool.forEach(n=>{this.pool.forEach(r=>{n!==r&&i.checkCollision(n,r)})})}static drawAll(e){this.pool.forEach(t=>t.draw(e))}static checkCollision(e,t){(e.x-t.x)**2+(e.y-t.y)**2<=i.COLLISION_DISTANCE**2&&(i.pool.splice(i.pool.indexOf(e),1),i.pool.splice(i.pool.indexOf(t),1))}constructor(e,t){this.color=t,this.currentDirection=H.UP,this.locked=!1,this.moved=!1,this.x=e.x+.5,this.y=e.y+.5,this.destinationTile={x:e.x,y:e.y},e.tileAction(this),i.pool.push(this)}getTile(e){return e[Math.floor(this.x)][Math.floor(this.y)]}setDestinationIn(e){this.moved||(this.currentDirection=e,this.destinationTile.x+=y.getDx(e),this.destinationTile.y+=y.getDy(e))}destroy(){i.pool.splice(i.pool.indexOf(this),1)}tick(e,t){this.move(e,t),this.getTile(t).tileAction(this)}draw(e){e.circle(c.unit(this.x),c.unit(this.y),i.SIZE/2,v.getTokenValue(N.CAR_OUTLINE)),e.circle(c.unit(this.x),c.unit(this.y),i.SIZE/2.5,this.color)}move(e,t){if(this.locked){if(!this.canEscapeTile(t))return;this.locked=!1}let n={x:this.destinationTile.x+.5,y:this.destinationTile.y+.5},r=Math.abs(this.x-n.x)+Math.abs(this.y-n.y),s=this.getTileSpeedMultiplier(t)*e;this.x+=y.getDx(this.currentDirection)*s,this.y+=y.getDy(this.currentDirection)*s,Math.abs(this.x-n.x)+Math.abs(this.y-n.y)>=r&&(this.x=n.x,this.y=n.y,this.canEscapeTile(t)?this.searchNewDestination(t):this.locked=!0),this.moved=!0}searchNewDestination(e){let t=y.getOpposite(this.currentDirection),n=y.turnRightFrom(this.currentDirection);for(let r=0;r<3;r++,n=y.turnLeftFrom(n)){let s=this.destinationTile.x+y.getDx(n),a=this.destinationTile.y+y.getDy(n),l=e[s]?.[a];if(l&&l.isUnlocked(this,e)){t=n;break}}this.currentDirection=t,this.destinationTile.x+=y.getDx(this.currentDirection),this.destinationTile.y+=y.getDy(this.currentDirection)}canEscapeTile(e){let t=!1;return this.getTile(e).forEachNeighbor(n=>{n.isUnlocked(this,e)&&(t=!0)}),t}getTileSpeedMultiplier(e){return this.getTile(e).road?.speedMultiplier??i.OFFROAD_SPEED_MULTIPLIER}}return i})();var De=class extends Error{constructor(o){super(o)}};function Re(i){let o=Math.ceil(i*10)/10,e=String(o).includes(".")?"":".0";return o+e}function Pe(i=0){return`rgba(0, 0, 0, ${i})`}var ne=class i extends ie{static{this.list=[]}static{this.STARTING_HEALTH=45}static{this.HEALTH_INCREASE=1}static{this.HEALING_PER_CAR=5}static{this.CRITICAL_HEALTH=15}static{this.CURRENT_HEALTH=i.STARTING_HEALTH}static anyWithZeroHealth(){return i.list.some(o=>o.health<=0)}constructor(o,e){super(o),this.color=e,this.carsReached=0,this._displayCarsReached$=new Se(this.carsReached),this.health=i.CURRENT_HEALTH,i.CURRENT_HEALTH+=i.HEALTH_INCREASE,i.list.push(this)}isSpawned(){return!0}onCarMove(o){this.color===o.color&&(this.health+=i.HEALING_PER_CAR,this.carsReached++,this._displayCarsReached$.next(this.carsReached),o.destroy(),k.getInstance().emitEvent(_.GAIN_SCORE,null))}tick(o){let e=this.health;this.health-=o,this.health<i.CRITICAL_HEALTH&&e>=i.CRITICAL_HEALTH&&k.getInstance().emitEvent(_.DESTINATION_CRITICAL_HEALTH,i.CRITICAL_HEALTH)}draw(o){let e=c.unit(this.tile.x+.5),t=c.unit(this.tile.y+.5);this.tile.selected&&o.circle(e,t,c.unit(),o.createRadialGradient(e,t,c.unit(.75),[.5,this.color],[1,Pe()])),o.circle(e,t,c.unit(.5),v.getTokenValue(N.BUILDING_OUTLINE)),o.circle(e,t,c.unit(.45),this.color),o.text(Math.ceil(this.health)+"s",e,t,c.unit(.45))}get displayCarsReached$(){return this._displayCarsReached$.asObservable()}};var ot=(()=>{class i extends ie{static{this.CAR_SPAWN_TIMER=4}constructor(e,t){super(e),this.color=t,this.timer=0,this._displayTimer$=new Se(Re(this.timer)),this.carsSpawned=0,this._displayCarsSpawned$=new Se(this.carsSpawned),this.timedPause=!1}isSpawned(){return!0}tick(e){this.tile.hasRoad()&&(this.timer-=e,this.timer<0&&(this.spawnCar(),this.timer=i.CAR_SPAWN_TIMER),this.emit())}delaySpawn(e){this.timer+=e,this.emit()}draw(e){e.lineWidth=2;let t=c.unit(this.tile.x+.5),n=c.unit(this.tile.y+.5);this.tile.selected&&e.circle(t,n,c.unit(.75),e.createRadialGradient(t,n,c.unit(.5),[.5,this.color],[1,Pe()])),e.circle(t,n,c.unit(.25),this.color),e.circle(t,n,c.unit(.25),v.getTokenValue(N.BUILDING_OUTLINE),!1),e.text(Math.ceil(this.timer)+"s",t,n,c.unit(.35))}get displayTimer$(){return this._displayTimer$.pipe(Ie())}get displayCarsSpawned$(){return this._displayCarsSpawned$.asObservable()}spawnCar(){let e=new Me(this.tile,this.color);y.forEachDirection((t,n,r,s)=>{let a=this.tile.getTileInDirection(t);a&&a.isUnlocked(e,this.tile)&&(e.setDestinationIn(t),s())}),this.timedPause&&(k.getInstance().emitEvent(_.TOGGLE_PAUSE,null),k.getInstance().emitEvent(_.COMPLETE_TIMED_PAUSE,null),this.timedPause=!1),this.carsSpawned++,this._displayCarsSpawned$.next(this.carsSpawned)}emit(){this._displayTimer$.next(Re(this.timer))}}return i})();var yt=(()=>{class i{static{this.SPAWNER_SPAWNING_CLEAR_RANGE=5}static{this.DESTINATION_SPAWNING_CLEAR_RANGE=5}static{this.SPAWNING_PADDING=4}static spawnSpawner(e,t){let n=this.getAvailableBuildingLocationsWithIterativelySmallerClearRange(e,i.SPAWNER_SPAWNING_CLEAR_RANGE,t),r=D.nextArrayElement(n),s=new ot(r,v.getRandomGameObjectColor());r.build(s)}static spawnDestination(e,t){let n=this.getAvailableBuildingLocationsWithIterativelySmallerClearRange(e,i.DESTINATION_SPAWNING_CLEAR_RANGE,t),r=D.nextArrayElement(n),s=[...v.getGameObjectColors()].filter(h=>h!==r.color),a=D.nextArrayElement(s),l=new ne(r,a);r.build(l)}static getAvailableBuildingLocationsWithIterativelySmallerClearRange(e,t,n){for(let r=t;r>1;r--){let s=this.getAvailableBuildingLocations(e,r);if(s.length>0){if(n){let a=this.filterTilesInPadding(s);if(a.length>0)return a}return s}}throw new De("No available tiles for spawning!")}static getAvailableBuildingLocations(e,t){let n=[],r=this.getTileDistancesFromSpawnedBuildings(e);return e.forEach((s,a)=>{s.forEach((l,h)=>{r[a][h]>t&&n.push(l)})}),n}static getTileDistancesFromSpawnedBuildings(e){let t=Array.from({length:c.COLUMN_COUNT},()=>Array.from({length:c.ROW_COUNT},()=>1/0));return e.flat().filter(r=>r.hasSpawnedBuilding()).forEach(r=>{this.setDistances(t,r.x,r.y,0)}),t}static setDistances(e,t,n,r){t<0||t>=c.COLUMN_COUNT||n<0||n>=c.ROW_COUNT||e[t][n]<=r||(e[t][n]=r,y.forEachDirection((s,a,l)=>{this.setDistances(e,t+a,n+l,r+1)}))}static filterTilesInPadding(e){return e.filter(t=>t.x>=this.SPAWNING_PADDING&&t.x<c.COLUMN_COUNT-this.SPAWNING_PADDING&&t.y>=this.SPAWNING_PADDING&&t.y<c.ROW_COUNT-this.SPAWNING_PADDING)}}return i})();var Ne=(()=>{class i{static{this.THICKNESS_UNIT=.5}static{this.SEGMENT_CONNECTION_OFFSET_UNIT=.16}constructor(e,t,n){this.tile=e,this.speedMultiplier=t,this.protectsFromRain=n,this.connections={[H.UP]:!1,[H.RIGHT]:!1,[H.DOWN]:!1,[H.LEFT]:!1}}connectTo(e){let t=this.getNeighborDirection(e);t!==null&&(this.connections[t]=!0,e.connections[y.getOpposite(t)]=!0)}removeConnection(e){this.connections[e]=!1}isConnectedTo(e){let t=this.getNeighborDirection(e);return t===null?!1:this.matchTypeWith(e)||this.connections[t]}drawRoadBase(e,t,n=i.THICKNESS_UNIT){e.strokeStyle=t,e.lineWidth=c.unit(n),e.lineCap="round",e.ctx.beginPath(),e.ctx.moveTo(c.unit(this.tile.x+.5),c.unit(this.tile.y+.5)),e.ctx.lineTo(c.unit(this.tile.x+.5),c.unit(this.tile.y+.5)),y.forEachDirection((r,s,a)=>{if(!this.tile.isConnectedWithRoad(r))return;let l=r===H.UP||r===H.LEFT?1:-1,h=Math.sign(s)*i.SEGMENT_CONNECTION_OFFSET_UNIT*l,d=Math.sign(a)*i.SEGMENT_CONNECTION_OFFSET_UNIT*l;e.ctx.lineTo(c.unit(this.tile.x+.5+s/2-h),c.unit(this.tile.y+.5+a/2-d)),e.ctx.moveTo(c.unit(this.tile.x+.5),c.unit(this.tile.y+.5))}),e.ctx.stroke()}getNeighborDirection(e){let t=null;return y.forEachDirection((n,r,s,a)=>{this.tile.x+r===e.tile.x&&this.tile.y+s===e.tile.y&&(t=n,a())}),t}}return i})();var Tt=(()=>{class i extends Ne{static{this.SPEED_MULTIPLIER=1}constructor(e){super(e,i.SPEED_MULTIPLIER,!1)}matchTypeWith(e){return e instanceof i}draw(e){this.drawRoadBase(e,v.getTokenValue(K.BASIC_ROAD))}drawRoadSegment(e,t,n,r,s){e.strokeStyle=v.getTokenValue(K.BASIC_ROAD),e.line(t,n,r,s,c.unit(.5))}getName(){return"Basic road"}}return i})();var Et=(()=>{class i extends Ne{static{this.INNER_THICKNESS_UNIT=.4}static{this.SPEED_MULTIPLIER=1}constructor(e){super(e,i.SPEED_MULTIPLIER,!0)}matchTypeWith(e){return e instanceof i}draw(e){this.drawRoadBase(e,v.getTokenValue(K.TUBE_OUTLINE)),this.drawRoadBase(e,v.getTokenValue(K.TUBE),i.INNER_THICKNESS_UNIT)}drawRoadSegment(e,t,n,r,s){e.strokeStyle=v.getTokenValue(K.TUBE_OUTLINE),e.line(t,n,r,s,c.unit(.5)),e.strokeStyle=v.getTokenValue(K.TUBE),e.line(t,n,r,s,c.unit(.4))}getName(){return"Tube"}}return i})();var at=class i{constructor(o,e){this.x=o,this.y=e,this.color=v.getBaseTileColor(),this.selected=!1,this.neighborMap={}}build(o){o instanceof ie?(!this.building||o.isSpawned())&&(this.building=o):o instanceof Ne&&!this.road&&(this.road=o)}tick(o){this.hasBuilding()&&"tick"in this.building&&typeof this.building?.tick=="function"&&this.building.tick(o)}tileAction(o){this.color!==v.getBaseTileColor()&&!this.road?.protectsFromRain&&(o.color=this.color),this.building?.onCarMove(o)}openContextMenu(){this.building&&k.getInstance().emitEvent(_.OPEN_CONTEXT_MENU,this.building)}isUnlocked(o,e){if(!this.road)return!1;let t=e instanceof i?e:o.getTile(e);return t.getConnectedRoadDirections().some(r=>t.getTileInDirection(r)===this)?!this.building?.isOccupyingFor(o):!1}connectRoadTo(o){!this.road||!o.road||this.road?.connectTo(o.road)}deleteBuilding(o){this.building&&o.isAssociatedItemSelected(this.building)?this.building=void 0:this.road&&o.isAssociatedItemSelected(this.road)&&(this.road=void 0,this.forEachNeighbor((e,t)=>{e.road&&e.road.removeConnection(y.getOpposite(t))}))}hasBuilding(){return!!this.building}hasSpawnedBuilding(){return this.hasBuilding()&&this.building.isSpawned()}hasRoad(){return!!this.road}getTileInDirection(o){return this.neighborMap[o]}assignNeighbors(o){y.forEachDirection(e=>{let t=this.x+y.getDx(e),n=this.y+y.getDy(e);t<0||t>=c.COLUMN_COUNT||n<0||n>=c.ROW_COUNT?this.neighborMap[e]=null:this.neighborMap[e]=o[t][n]})}draw(o){o.square(c.unit(this.x),c.unit(this.y),c.unit(),this.color)}drawBuilding(o){this.building&&this.building.draw(o)}drawRoad(o){this.road&&this.road.draw(o)}forEachNeighbor(o){y.forEachDirection(e=>{let t=this.getTileInDirection(e);t&&o(t,e)})}isConnectedWithRoad(o){return this.getConnectedRoadDirections().includes(o)}getConnectedRoadDirections(){let o=[];return y.forEachDirection(e=>{let t=this.getTileInDirection(e);t?.road&&this.road?.isConnectedTo(t.road)&&o.push(e)}),o}};var rt=class i{static{this.MIN_CLOUD_COVERAGE_RATIO=.6}static{this.MAX_CLOUD_COVERAGE_RATIO=.65}static{this.MIN_CLOUD_SIZE_GROWTH_CHANCE_CONSTANT=.4}static{this.MAX_CLOUD_SIZE_GROWTH_CHANCE_CONSTANT=.45}static{this.MIN_COLOR_COUNT=10}static{this.MAX_COLOR_INCREASE_COUNT=1/0}static{this.PADDING_FILTER_PAIR_LIMIT=3}constructor(){this.tiles=[],this.spawnerAndDestinationPairs=0,this.initTiles(),this.initTileColors()}tick(o){this.forEachTile(e=>e.tick(o)),Me.tickAll(o,this.tiles)}spawnSpawnerAndDestination(){let o=this.spawnerAndDestinationPairs<i.PADDING_FILTER_PAIR_LIMIT;yt.spawnSpawner(this.tiles,o),yt.spawnDestination(this.tiles,o),this.spawnerAndDestinationPairs++}draw(o){o.clear(),this.forEachTile(e=>e.draw(o)),this.drawMapGrid(o),this.forEachTile(e=>e.drawRoad(o)),Me.drawAll(o),this.forEachTile(e=>e.drawBuilding(o))}forEachTile(o){this.tiles.forEach(e=>{e.forEach(t=>{o(t)})})}initTileColors(){let o=c.ROW_COUNT*c.COLUMN_COUNT*i.MIN_CLOUD_COVERAGE_RATIO,e=c.ROW_COUNT*c.COLUMN_COUNT*i.MAX_CLOUD_COVERAGE_RATIO,t=0;for(;t<o;)t+=this.spread(this.chooseSpreadColor(),this.getRandomGrowthChanceConstant(),e-t);let n;for(;(n=this.getColorCounts()[0]).count<i.MIN_COLOR_COUNT;)this.spread(n.color,this.getRandomGrowthChanceConstant(),i.MAX_COLOR_INCREASE_COUNT,!0)}spread(o,e,t,n=!1){let r=[this.getRandomTile(n)],s=0;for(;r.length>0;){let a=r.splice(0,1)[0];if(a.color===o)continue;let l=a.color!==v.getBaseTileColor();n===l&&(a.color=o,s++,a.forEachNeighbor(h=>{s<t&&D.nextChance(e)&&r.push(h)}))}return s}chooseSpreadColor(){return D.nextArrayElement(v.getGameObjectColors())}drawMapGrid(o){o.strokeStyle=v.getTokenValue(N.GRID),o.lineCap="square",o.lineWidth=1;for(let e=1;e<c.COLUMN_COUNT;e++)o.line(c.unit(e),0,c.unit(e),c.unit(c.ROW_COUNT),1);for(let e=1;e<c.ROW_COUNT;e++)o.line(0,c.unit(e),c.unit(c.COLUMN_COUNT),c.unit(e),1)}initTiles(){for(let o=0;o<c.COLUMN_COUNT;o++){this.tiles[o]=[];for(let e=0;e<c.ROW_COUNT;e++)this.tiles[o][e]=new at(o,e)}this.tiles.flat().forEach(o=>o.assignNeighbors(this.tiles))}getColorCounts(){let o=v.getGameObjectColors().reduce((e,t)=>[...e,{color:t,count:0}],[]);return this.tiles.flat().forEach(e=>{let t=o.find(n=>n.color===e.color);t&&t.count++}),o.sort((e,t)=>e.count-t.count),o}getRandomGrowthChanceConstant(){return D.between(i.MIN_CLOUD_SIZE_GROWTH_CHANCE_CONSTANT,i.MAX_CLOUD_SIZE_GROWTH_CHANCE_CONSTANT)}getRandomTile(o){let e=v.getBaseTileColor(),t=o?n=>n.color!==e:n=>n.color===e;return D.nextArrayElement(this.tiles.flat().filter(t))}};var kn=Rn(xn()),D=class{static registerSeed(o){this.random=(0,kn.default)(o)}static between(o,e){if(!this.random)throw new Error("Random seed not registered!");return this.random()*(e-o)+o}static nextIntRange(o,e){return Math.floor(this.between(o,e))}static nextInt(o){return this.nextIntRange(0,o)}static nextArrayElement(o){return o[this.nextInt(o.length)]}static nextNArrayElements(o,e){if(o.length<e)throw new Error("Not enough elements in array to get N elements!");if(o.length===e)return[...o];let t=[],n=[...o];for(;t.length<e;){let r=this.nextArrayElement(n);n.remove(r),t.push(r)}return t}static nextChance(o=.5){if(!this.random)throw new Error("Random seed not registered!");return this.random()<o}};var st=class{static cleanUp(){ne.list.splice(0),oe.instance.set(null),Me.pool.splice(0),D.random=void 0,k.clean()}};var N=function(i){return i.GRID="--rd-game-grid-color",i.BUILDING_OUTLINE="--rd-game-building-outline-color",i.CAR_OUTLINE="--rd-game-car-outline-color",i.TEXT="--rd-game-text-color",i.WARN="--rd-game-warn-color",i}(N||{}),K=function(i){return i.BASIC_ROAD="--rd-game-basic-road-color",i.TUBE_OUTLINE="--rd-game-tube-outline-color",i.TUBE="--rd-game-tube-color",i.TIMED_GATE_OPEN="--rd-game-timed-gate-open-color",i.TIMED_GATE_CLOSED="--rd-game-timed-gate-closed-color",i}(K||{}),v=(()=>{class i{static{this.propertyValueCache={}}static getTokenValue(e){return this.getPropertyValue(e)}static getBaseTileColor(){return this.getPropertyValue("--rd-game-tile-color-base")}static getGameObjectColors(){let e=[],t;for(let n=1;t=this.getPropertyValue(`--rd-game-tile-color-${n}`),!!t;n++)e.push(t);return e}static getRandomGameObjectColor(){return D.nextArrayElement(this.getGameObjectColors())}static getPropertyValue(e){return this.propertyValueCache[e]||(this.propertyValueCache[e]=window.getComputedStyle(document.body).getPropertyValue(e)),this.propertyValueCache[e]}}return i})();var y=class i{static forEachDirection(o,e){let t=!1,n=()=>t=!0;for(let r=e?.startingDirection??H.UP,s=0;s<4&&(o(r,i.getDx(r),i.getDy(r),n),!t);r=e?.counterclockwise?this.turnLeftFrom(r):this.turnRightFrom(r),s++);}static turnRightFrom(o){return(o+1)%4}static turnLeftFrom(o){return(o+3)%4}static getOpposite(o){return(o+2)%4}static getDx(o){return[0,1,0,-1][o]}static getDy(o){return[-1,0,1,0][o]}};var Ee=(()=>{class i{static{this.TOOLBAR_HEIGHT_REM=7.5}static{this.CANVAS_BORDER_WIDTH_REM=.5}static getMaxTileSize(e,t){let n=Math.floor(this.getMaxAvailableWidth()/t),r=Math.floor(this.getMaxAvailableHeight()/e);return Math.min(r,n)}static remToPx(e){return e*parseFloat(getComputedStyle(document.documentElement).fontSize)}static getMaxAvailableWidth(){return Math.round(window.innerWidth*.95-2*this.remToPx(this.CANVAS_BORDER_WIDTH_REM))}static getMaxAvailableHeight(){return Math.round(window.innerHeight*.95-this.remToPx(this.TOOLBAR_HEIGHT_REM)-2*this.remToPx(this.CANVAS_BORDER_WIDTH_REM))}}return i})();var Be=class extends ie{isSpawned(){return!1}};var Oe=class extends Be{constructor(o,e){super(o),this.color=e}isOccupyingFor(o){return o.color===this.color}draw(o){o.square(c.unit(this.tile.x+.25),c.unit(this.tile.y+.25),c.unit(.5),v.getTokenValue(N.BUILDING_OUTLINE)),o.square(c.unit(this.tile.x+.3),c.unit(this.tile.y+.3),c.unit(.4),this.color)}};var we=(()=>{class i extends Be{static{this.BARRIER_TIMER=4}constructor(e){super(e),this.timer=i.BARRIER_TIMER,this._displayTimer$=new Se(Re(this.timer)),this.closed=xe(!1),this.timedPause=!1}switch(){this.closed.update(e=>!e),this.emit(),this.timedPause&&(k.getInstance().emitEvent(_.TOGGLE_PAUSE,null),k.getInstance().emitEvent(_.COMPLETE_TIMED_PAUSE,null),this.timedPause=!1)}isOccupyingFor(){return this.closed()}tick(e){this.timer-=e,this.emit(),this.timer<0&&(this.timer=i.BARRIER_TIMER,this.switch())}draw(e){let t=this.closed()?v.getTokenValue(K.TIMED_GATE_CLOSED):v.getTokenValue(K.TIMED_GATE_OPEN);if(this.tile.selected&&e.circle(c.unit(this.tile.x+.5),c.unit(this.tile.y+.5),c.unit(.75),e.createRadialGradient(c.unit(this.tile.x+.5),c.unit(this.tile.y+.5),c.unit(.5),[.45,t],[1,Pe()])),e.square(c.unit(this.tile.x+.25),c.unit(this.tile.y+.25),c.unit(.5),v.getTokenValue(N.BUILDING_OUTLINE)),e.square(c.unit(this.tile.x+.3),c.unit(this.tile.y+.3),c.unit(.4),t),this.closed()){e.strokeStyle=v.getTokenValue(N.WARN);let n=c.unit(.05);e.line(c.unit(this.tile.x+.3)+n/2,c.unit(this.tile.y+.3)+n/2,c.unit(this.tile.x+.7)-n/2,c.unit(this.tile.y+.7)-n/2,n),e.line(c.unit(this.tile.x+.3)+n/2,c.unit(this.tile.y+.7)-n/2,c.unit(this.tile.x+.7)-n/2,c.unit(this.tile.y+.3)+n/2,n)}}get isClosed(){return this.closed.asReadonly()}get displayTimer$(){return this._displayTimer$.pipe(Ie())}emit(){this._displayTimer$.next(Re(this.timer))}}return i})();var L=function(i){return i[i.EDITOR_TOOL=0]="EDITOR_TOOL",i[i.ROAD=1]="ROAD",i[i.TUBE=2]="TUBE",i[i.COLORED_GATE_1=3]="COLORED_GATE_1",i[i.COLORED_GATE_2=4]="COLORED_GATE_2",i[i.TIMED_GATE=5]="TIMED_GATE",i}(L||{});var oe=class i{static{this.INITIAL_SELECTED_ITEM_KEY=1}static{this.instance=xe(null)}static inject(){return this.instance.asReadonly()}constructor(){this.items=[{displayName:"Editor tool",selection:L.EDITOR_TOOL,factory:()=>null,selectionMatchFn:()=>!1},{displayName:"Road",selection:L.ROAD,factory:o=>new Tt(o),selectionMatchFn:o=>o instanceof Tt},{displayName:"Tube",selection:L.TUBE,factory:o=>new Et(o),selectionMatchFn:o=>o instanceof Et},{displayName:"Colored gate",selection:L.COLORED_GATE_1,factory:o=>new Oe(o,this.gate1Color),selectionMatchFn:o=>o instanceof Oe&&o.color===this.gate1Color},{displayName:"Colored gate",selection:L.COLORED_GATE_2,factory:o=>new Oe(o,this.gate2Color),selectionMatchFn:o=>o instanceof Oe&&o.color===this.gate2Color},{displayName:"Timed gate",selection:L.TIMED_GATE,factory:o=>new we(o),selectionMatchFn:o=>o instanceof we}],[this.gate1Color,this.gate2Color]=D.nextNArrayElements(v.getGameObjectColors(),2),k.getInstance().watchEvents(_.SELECT_TOOLBAR_ITEM,o=>{this.selectedToolbarItem=this.items[o]}),i.instance.set(this)}createBuildingFromSelection(o){return this.selectedToolbarItem.factory(o)}isAssociatedItemSelected(o){return this.selectedToolbarItem.selectionMatchFn(o)}selectItemByKey(o){for(;o<0;)o+=this.items.length;for(;o>=this.items.length;)o-=this.items.length;k.getInstance().emitEvent(_.SELECT_TOOLBAR_ITEM,o)}stepSelectedItem(o){let e=this.items.indexOf(this.selectedToolbarItem);if(e===-1){this.selectItemByKey(0);return}this.selectItemByKey(e+o)}get selection(){return this.selectedToolbarItem.selection}};var _=function(i){return i.START_GAME="startGame",i.TOGGLE_PAUSE="togglePause",i.SELECT_TOOLBAR_ITEM="selectToolbarItem",i.UPDATE_SPAWN_TIMER="updateSpawnTimer",i.DESTINATION_CRITICAL_HEALTH="destinationCriticalHealth",i.GAIN_SCORE="gainScore",i.OPEN_CONTEXT_MENU="openContextMenu",i.CLOSE_CONTEXT_MENU="closeContextMenu",i.COMPLETE_TIMED_PAUSE="completeTimedPause",i.GAME_OVER="gameOver",i}(_||{});var k=class i{static{this.DESTINATION_HEALTH_MESSAGE_COOLDOWN_S=10}static{this.EVENT_TYPE_EXTRA_PIPELINE_MAP={[_.SELECT_TOOLBAR_ITEM]:Ue(ni(oe.INITIAL_SELECTED_ITEM_KEY),Ie(),ht(1)),[_.UPDATE_SPAWN_TIMER]:Ue(Ie(),ht(1)),[_.DESTINATION_CRITICAL_HEALTH]:Ue(ri(i.DESTINATION_HEALTH_MESSAGE_COOLDOWN_S*1e3)),[_.OPEN_CONTEXT_MENU]:Ue(ht(1))}}static getInstance(){return this.instance||(this.instance=new i),this.instance}static clean(){i.getInstance().subscriptions.forEach(o=>o.unsubscribe()),i.instance=void 0}constructor(){this.mergedEvents$=new se,this.eventMap={},this.subscriptions=[],Object.values(_).forEach(o=>{this.eventMap[o]=this.mergedEvents$.pipe(te(e=>e.type===o),ce(e=>e.data),i.EVENT_TYPE_EXTRA_PIPELINE_MAP[o]??Ue())})}emitEvent(o,e){this.mergedEvents$.next({type:o,data:e})}watchEvents(o,e){this.subscriptions.push(this.eventMap[o].subscribe(t=>e(t)))}};function Kn(i,o){i&1&&(u(0,"hgroup",1)(1,"h2"),x(2,"Victory"),p(),u(3,"p",10),x(4,"for now..."),p()())}function Qn(i,o){i&1&&(u(0,"hgroup",2)(1,"h2"),x(2,"Game Over!"),p()())}function Jn(i,o){if(i&1&&(u(0,"td"),x(1,"Best:"),p(),u(2,"td"),x(3),p()),i&2){let e=A();b(3),le(e.dialogData.best)}}function eo(i,o){i&1&&(u(0,"td",6),x(1,"New personal best!"),p())}function to(i,o){if(i&1){let e=G();u(0,"button",11),S("click",function(){O(e);let n=A();return w(n.revealSeed())}),x(1,"Reveal seed"),p()}}function io(i,o){if(i&1&&(u(0,"div"),x(1),p()),i&2){let e=A();b(),le(e.dialogData.seed)}}var Cn=(()=>{class i{constructor(){this.dialogData=C(Fi),this.dialogRef=C(Ui),this.router=C(Si),this.isSeedRevealed=!1}playAgain(){window.location.reload()}backToMenu(){this.router.navigateByUrl(Qi.MENU),this.dialogRef.close()}revealSeed(){this.isSeedRevealed=!0}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=E({type:i,selectors:[["rd-end-of-game-dialog"]],decls:20,vars:6,consts:[[1,"end-of-game-dialog-wrapper"],[1,"victory"],[1,"defeat"],[1,"score-container"],[1,"score"],[1,"best"],["colspan","2"],[1,"buttons-container"],["mat-flat-button","","color","accent",3,"click"],[1,"seed-container"],[1,"subtitle"],[3,"click"]],template:function(t,n){t&1&&(u(0,"div",0),F(1,Kn,5,0,"hgroup",1)(2,Qn,3,0,"hgroup",2),u(3,"table",3)(4,"tr",4)(5,"td"),x(6,"Score:"),p(),u(7,"td"),x(8),p()(),u(9,"tr",5),F(10,Jn,4,1)(11,eo,2,0,"td",6),p()(),u(12,"div",7)(13,"button",8),S("click",function(){return n.playAgain()}),x(14," Play again "),p(),u(15,"button",8),S("click",function(){return n.backToMenu()}),x(16," Back to menu "),p()(),u(17,"div",9),F(18,to,2,0,"button")(19,io,2,1,"div"),p()()),t&2&&(b(),q(n.dialogData.isVictory?1:2),b(3),P("best",n.dialogData.isNewBest),b(4),le(n.dialogData.score),b(2),q(n.dialogData.isNewBest?11:10),b(8),q(n.isSeedRevealed?19:18))},dependencies:[Ft,qe],styles:['[_nghost-%COMP%]{display:grid;grid-template-columns:calc(30dvw - 4rem);background-color:var(--rd-primary);padding:2rem;width:30dvw;height:70dvh;min-height:37.5rem;box-sizing:border-box}[_nghost-%COMP%]   .end-of-game-dialog-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;align-items:center;padding:1rem;background-color:var(--rd-dialog-background-color);border-radius:var(--mdc-dialog-container-shape)}hgroup[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:2.5rem;margin:0}hgroup[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{font-size:1.5rem;text-align:center;margin:0}.victory[_ngcontent-%COMP%]{color:var(--rd-primary-darker)}.defeat[_ngcontent-%COMP%]{color:var(--rd-warn)}.score-container[_ngcontent-%COMP%]{table-layout:fixed;margin-block:1.5rem}.score-container[_ngcontent-%COMP%]   .score[_ngcontent-%COMP%], .score-container[_ngcontent-%COMP%]   .best[_ngcontent-%COMP%]{font-size:1.5rem}.score-container[_ngcontent-%COMP%]   .score[_ngcontent-%COMP%]:not(:first-child), .score-container[_ngcontent-%COMP%]   .best[_ngcontent-%COMP%]:not(:first-child){margin-top:.5rem}.score-container[_ngcontent-%COMP%]   .best[_ngcontent-%COMP%]{color:var(--rd-accent)}.score-container[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{width:50%}.score-container[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-child{text-align:end;padding-right:.5rem}.score-container[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child{text-align:start}.score-container[_ngcontent-%COMP%]   td[colspan="2"][_ngcontent-%COMP%]{text-align:center;padding-right:revert-layer}.buttons-container[_ngcontent-%COMP%]{align-self:stretch}.buttons-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:1.25rem;height:3rem}.seed-container[_ngcontent-%COMP%]{width:100%}.seed-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{color:var(--rd-white);font-size:1.25rem;height:3rem;background-color:var(--rd-accent);border:none;border-radius:var(--mdc-filled-button-container-shape);text-overflow:ellipsis;white-space:nowrap;overflow:hidden;width:100%}.seed-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{cursor:pointer}.seed-container[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{text-align:center;line-height:2rem;padding:.5rem;box-sizing:border-box}'],changeDetection:0})}}return i})();var fe=class{constructor(o,e){this.type=o,this.listener=e,document.addEventListener(o,e)}destroy(){document.removeEventListener(this.type,this.listener)}};var Yt=(()=>{class i{static{this.ROAD_CONNECTION_PREVIEW_ALPHA=.4}constructor(e){this.tiles=e,this.leftMouseDown=!1,this.rightMouseDown=!1,this.toolbar=new oe,this.eventListeners=[],this.cursor={x:0,y:0}}registerEventListeners(){this.eventListeners.push(new fe("mousedown",e=>{e.button===0?this.onLeftMouseDown(e):this.onRightMouseDown(e)})),this.eventListeners.push(new fe("mouseup",e=>{e.button===0?this.onLeftMouseUp(e):this.onRightMouseUp(e)})),this.eventListeners.push(new fe("mousemove",this.onMouseMove.bind(this))),this.eventListeners.push(new fe("keypress",this.onKeyDown.bind(this))),this.eventListeners.push(new fe("wheel",e=>{e.deltaY<0?this.onScrollUp(e):e.deltaY>0&&this.onScrollDown(e)}))}unregisterEventListeners(){this.eventListeners.forEach(e=>e.destroy())}handleMouseActions(){this.selectedTile&&(this.leftMouseDown?this.leftMouseAction():this.rightMouseDown&&this.rightMouseAction())}leftMouseAction(){if(!this.selectedTile)return;let e=this.toolbar.createBuildingFromSelection(this.selectedTile);e?this.selectedTile.build(e):this.toolbar.selection==L.EDITOR_TOOL&&this.selectedTile.hasRoad()&&this.roadConnectionBase&&this.roadConnectionBase!==this.selectedTile&&(this.selectedTile.connectRoadTo(this.roadConnectionBase),this.roadConnectionBase=this.selectedTile)}rightMouseAction(){this.toolbar.selection===L.EDITOR_TOOL?this.selectedTile.openContextMenu():this.selectedTile.deleteBuilding(this.toolbar)}draw(e){if(this.roadConnectionBase){let t=c.unit(this.roadConnectionBase.x+.5),n=c.unit(this.roadConnectionBase.y+.5),r=Math.sqrt((t-this.cursor.x)**2+(n-this.cursor.y)**2);e.alpha=i.ROAD_CONNECTION_PREVIEW_ALPHA,this.roadConnectionBase.road.drawRoadSegment(e,t,n,this.cursor.x,this.cursor.y),e.alpha=1,r>c.unit(2)&&e.text("!",(t+this.cursor.x)/2,(n+this.cursor.y)/2,c.unit(1.5),v.getTokenValue(N.WARN))}}onLeftMouseDown(e){this.leftMouseDown=!0,this.toolbar.selection===L.EDITOR_TOOL&&this.selectedTile&&this.selectedTile.hasRoad()&&(this.roadConnectionBase=this.selectedTile)}onRightMouseDown(e){this.rightMouseDown=!0}onLeftMouseUp(e){this.leftMouseDown=!1,this.toolbar.selection===L.EDITOR_TOOL&&this.roadConnectionBase&&(this.roadConnectionBase=void 0)}onRightMouseUp(e){this.rightMouseDown=!1}onMouseMove(e){if(this.cursor.x=e.offsetX,this.cursor.y=e.offsetY,!(e.target instanceof HTMLCanvasElement)){this.selectedTile=void 0;return}let t=Math.floor(e.offsetX/c.unit()),n=Math.floor(e.offsetY/c.unit());if(t<0||t>=c.COLUMN_COUNT||n<0||n>=c.ROW_COUNT){this.selectedTile=void 0;return}this.selectedTile=this.tiles[t][n]}onKeyDown(e){if(e.code==="Space"){k.getInstance().emitEvent(_.TOGGLE_PAUSE,null);return}let t=Number(e.key);Number.isNaN(t)||(this.toolbar.selection===L.EDITOR_TOOL&&this.roadConnectionBase&&(this.roadConnectionBase=void 0),this.toolbar.selectItemByKey(t))}onScrollDown(e){this.toolbar.stepSelectedItem(1)}onScrollUp(e){this.toolbar.stepSelectedItem(-1)}set selectedTile(e){this.setTileSelection(this._selectedTile,!1),this._selectedTile=e,this.setTileSelection(this._selectedTile,!0)}get selectedTile(){return this._selectedTile}setTileSelection(e,t){e&&(e.selected=t)}}return i})();var Ge=class{constructor(o){this.canvas=o,this._ctx=this.canvas.getContext("2d"),this.onResize()}onResize(){this._ctx.textAlign="center",this._ctx.textBaseline="middle"}line(o,e,t,n,r){this.lineWidth=r,this._ctx.beginPath(),this._ctx.moveTo(o,e),this._ctx.lineTo(t,n),this._ctx.stroke()}square(o,e,t,n,r=!0){r?this.fillStyle=n:this.strokeStyle=n,this._ctx.beginPath(),this._ctx.rect(o,e,t,t),this._ctx[r?"fill":"stroke"]()}circle(o,e,t,n,r=!0){r?this.fillStyle=n:this.strokeStyle=n,this._ctx.beginPath(),this._ctx.arc(o,e,t,0,Math.PI*2),this._ctx[r?"fill":"stroke"]()}text(o,e,t,n,r){this.fillStyle=r??v.getTokenValue(N.TEXT),this.fontSize=n,this._ctx.fillText(o,e,t)}clear(){this._ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}createRadialGradient(o,e,t,...n){let r=this._ctx.createRadialGradient(o,e,0,o,e,t);return n.forEach(([s,a])=>{r.addColorStop(s,a)}),r}set strokeStyle(o){this._ctx.strokeStyle!==o&&(this._ctx.strokeStyle=o)}set fillStyle(o){this._ctx.fillStyle!==o&&(this._ctx.fillStyle=o)}set lineWidth(o){this._ctx.lineWidth!==o&&(this._ctx.lineWidth=o)}set lineCap(o){this._ctx.lineCap!==o&&(this._ctx.lineCap=o)}set alpha(o){this._ctx.globalAlpha!==o&&(this._ctx.globalAlpha=o)}set fontSize(o){let e=o+"px Serif";this._ctx.font!==e&&(this._ctx.font=e)}get ctx(){return this._ctx}};var vn=(()=>{class i{static{this.BUILDING_SPAWN_TIMER=45}constructor(e,t){this.status=t,this.spawnTimer=i.BUILDING_SPAWN_TIMER,this.exited=!1,this.victory=!1,this.map=new rt,this.map.spawnSpawnerAndDestination(),this.controller=new Yt(this.map.tiles),this.drawer=new Ge(e)}startGame(){this.controller.registerEventListeners(),this.gameInterval(Date.now())}onResize(){this.drawer.onResize(),this.status().isGameGoing||this.draw()}stop(){this.exited=!0,st.cleanUp()}gameInterval(e){let t=Date.now(),n=t-e;this.main(n/1e3)&&!this.exited?requestAnimationFrame(()=>this.gameInterval(t)):(this.controller.unregisterEventListeners(),k.getInstance().emitEvent(_.GAME_OVER,this.victory),k.getInstance().emitEvent(_.CLOSE_CONTEXT_MENU,null))}main(e){if(!this.status().isPaused)for(let t=0;t<this.status().gameSpeed;t++)e=Math.min(e,.1),this.timedActions(e),this.map.tick(e);return this.controller.handleMouseActions(),this.draw(),this.status().isPaused||!this.isEndOfGame()}draw(){this.map.draw(this.drawer),this.controller.draw(this.drawer)}isEndOfGame(){return ne.anyWithZeroHealth()||this.victory}timedActions(e){if((this.spawnTimer-=e)<=0){this.spawnTimer=i.BUILDING_SPAWN_TIMER;try{this.map.spawnSpawnerAndDestination()}catch(t){if(t instanceof De)this.victory=!0;else throw t}}k.getInstance().emitEvent(_.UPDATE_SPAWN_TIMER,Math.floor(this.spawnTimer))}}return i})();var ct=function(i){return i[i.SPAWNER=0]="SPAWNER",i[i.DESTINATION=1]="DESTINATION",i[i.TIMED_GATE=2]="TIMED_GATE",i}(ct||{});var yn=(()=>{class i{constructor(){this.building=U.required(),this.roadName=Z(()=>{let e=this.building().tile.road;return e?e.getName():"None"})}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=E({type:i,selectors:[["rd-destination-context-menu"]],inputs:{building:[1,"building"]},decls:9,vars:4,template:function(t,n){t&1&&(u(0,"h3"),x(1,"Destination"),p(),u(2,"p"),x(3),ue(4,"async"),p(),u(5,"p"),x(6," Road type: "),u(7,"strong"),x(8),p()()),t&2&&(b(3),X("Cars arrived: ",pe(4,2,n.building().displayCarsReached$),""),b(5),le(n.roadName()))},dependencies:[We],styles:["[_nghost-%COMP%]{-webkit-user-select:none;user-select:none}h3[_ngcontent-%COMP%]{margin:0 0 1rem;color:var(--rd-primary-darker)}button[_ngcontent-%COMP%]{font-size:.875rem;border:1px solid black;border-radius:.5rem;outline:none;background-color:var(--rd-white);height:2rem;text-align:center;cursor:pointer}"],changeDetection:0})}}return i})();var no=["mat-internal-form-field",""],oo=["*"],Tn=(()=>{class i{labelPosition;static \u0275fac=function(t){return new(t||i)};static \u0275cmp=E({type:i,selectors:[["div","mat-internal-form-field",""]],hostAttrs:[1,"mdc-form-field","mat-internal-form-field"],hostVars:2,hostBindings:function(t,n){t&2&&P("mdc-form-field--align-end",n.labelPosition==="before")},inputs:{labelPosition:"labelPosition"},attrs:no,ngContentSelectors:oo,decls:1,vars:0,template:function(t,n){t&1&&(Fe(),Ve(0))},styles:[".mat-internal-form-field{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;display:inline-flex;align-items:center;vertical-align:middle}.mat-internal-form-field>label{margin-left:0;margin-right:auto;padding-left:4px;padding-right:0;order:0}[dir=rtl] .mat-internal-form-field>label{margin-left:auto;margin-right:0;padding-left:0;padding-right:4px}.mdc-form-field--align-end>label{margin-left:auto;margin-right:0;padding-left:0;padding-right:4px;order:-1}[dir=rtl] .mdc-form-field--align-end .mdc-form-field--align-end label{margin-left:0;margin-right:auto;padding-left:4px;padding-right:0}"],encapsulation:2,changeDetection:0})}return i})();var ao=["input"],ro=["label"],so=["*"],co=new Ke("mat-checkbox-default-options",{providedIn:"root",factory:Mn});function Mn(){return{color:"accent",clickAction:"check-indeterminate",disabledInteractive:!1}}var z=function(i){return i[i.Init=0]="Init",i[i.Checked=1]="Checked",i[i.Unchecked=2]="Unchecked",i[i.Indeterminate=3]="Indeterminate",i}(z||{}),lo={provide:$i,useExisting:si(()=>Ot),multi:!0},Zt=class{source;checked},En=Mn(),Ot=(()=>{class i{_elementRef=C(be);_changeDetectorRef=C(ze);_ngZone=C(ft);_animationMode=C(gt,{optional:!0});_options=C(co,{optional:!0});focus(){this._inputElement.nativeElement.focus()}_createChangeEvent(e){let t=new Zt;return t.source=this,t.checked=e,t}_getAnimationTargetElement(){return this._inputElement?.nativeElement}_animationClasses={uncheckedToChecked:"mdc-checkbox--anim-unchecked-checked",uncheckedToIndeterminate:"mdc-checkbox--anim-unchecked-indeterminate",checkedToUnchecked:"mdc-checkbox--anim-checked-unchecked",checkedToIndeterminate:"mdc-checkbox--anim-checked-indeterminate",indeterminateToChecked:"mdc-checkbox--anim-indeterminate-checked",indeterminateToUnchecked:"mdc-checkbox--anim-indeterminate-unchecked"};ariaLabel="";ariaLabelledby=null;ariaDescribedby;ariaExpanded;ariaControls;ariaOwns;_uniqueId;id;get inputId(){return`${this.id||this._uniqueId}-input`}required;labelPosition="after";name=null;change=new At;indeterminateChange=new At;value;disableRipple;_inputElement;_labelElement;tabIndex;color;disabledInteractive;_onTouched=()=>{};_currentAnimationClass="";_currentCheckState=z.Init;_controlValueAccessorChangeFn=()=>{};_validatorChangeFn=()=>{};constructor(){C(Ni).load(Wi);let e=C(new mi("tabindex"),{optional:!0});this._options=this._options||En,this.color=this._options.color||En.color,this.tabIndex=e==null?0:parseInt(e)||0,this.id=this._uniqueId=C(vt).getId("mat-mdc-checkbox-"),this.disabledInteractive=this._options?.disabledInteractive??!1}ngOnChanges(e){e.required&&this._validatorChangeFn()}ngAfterViewInit(){this._syncIndeterminate(this._indeterminate)}get checked(){return this._checked}set checked(e){e!=this.checked&&(this._checked=e,this._changeDetectorRef.markForCheck())}_checked=!1;get disabled(){return this._disabled}set disabled(e){e!==this.disabled&&(this._disabled=e,this._changeDetectorRef.markForCheck())}_disabled=!1;get indeterminate(){return this._indeterminate}set indeterminate(e){let t=e!=this._indeterminate;this._indeterminate=e,t&&(this._indeterminate?this._transitionCheckState(z.Indeterminate):this._transitionCheckState(this.checked?z.Checked:z.Unchecked),this.indeterminateChange.emit(this._indeterminate)),this._syncIndeterminate(this._indeterminate)}_indeterminate=!1;_isRippleDisabled(){return this.disableRipple||this.disabled}_onLabelTextChange(){this._changeDetectorRef.detectChanges()}writeValue(e){this.checked=!!e}registerOnChange(e){this._controlValueAccessorChangeFn=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e}validate(e){return this.required&&e.value!==!0?{required:!0}:null}registerOnValidatorChange(e){this._validatorChangeFn=e}_transitionCheckState(e){let t=this._currentCheckState,n=this._getAnimationTargetElement();if(!(t===e||!n)&&(this._currentAnimationClass&&n.classList.remove(this._currentAnimationClass),this._currentAnimationClass=this._getAnimationClassForCheckStateTransition(t,e),this._currentCheckState=e,this._currentAnimationClass.length>0)){n.classList.add(this._currentAnimationClass);let r=this._currentAnimationClass;this._ngZone.runOutsideAngular(()=>{setTimeout(()=>{n.classList.remove(r)},1e3)})}}_emitChangeEvent(){this._controlValueAccessorChangeFn(this.checked),this.change.emit(this._createChangeEvent(this.checked)),this._inputElement&&(this._inputElement.nativeElement.checked=this.checked)}toggle(){this.checked=!this.checked,this._controlValueAccessorChangeFn(this.checked)}_handleInputClick(){let e=this._options?.clickAction;!this.disabled&&e!=="noop"?(this.indeterminate&&e!=="check"&&Promise.resolve().then(()=>{this._indeterminate=!1,this.indeterminateChange.emit(this._indeterminate)}),this._checked=!this._checked,this._transitionCheckState(this._checked?z.Checked:z.Unchecked),this._emitChangeEvent()):(this.disabled&&this.disabledInteractive||!this.disabled&&e==="noop")&&(this._inputElement.nativeElement.checked=this.checked,this._inputElement.nativeElement.indeterminate=this.indeterminate)}_onInteractionEvent(e){e.stopPropagation()}_onBlur(){Promise.resolve().then(()=>{this._onTouched(),this._changeDetectorRef.markForCheck()})}_getAnimationClassForCheckStateTransition(e,t){if(this._animationMode==="NoopAnimations")return"";switch(e){case z.Init:if(t===z.Checked)return this._animationClasses.uncheckedToChecked;if(t==z.Indeterminate)return this._checked?this._animationClasses.checkedToIndeterminate:this._animationClasses.uncheckedToIndeterminate;break;case z.Unchecked:return t===z.Checked?this._animationClasses.uncheckedToChecked:this._animationClasses.uncheckedToIndeterminate;case z.Checked:return t===z.Unchecked?this._animationClasses.checkedToUnchecked:this._animationClasses.checkedToIndeterminate;case z.Indeterminate:return t===z.Checked?this._animationClasses.indeterminateToChecked:this._animationClasses.indeterminateToUnchecked}return""}_syncIndeterminate(e){let t=this._inputElement;t&&(t.nativeElement.indeterminate=e)}_onInputClick(){this._handleInputClick()}_onTouchTargetClick(){this._handleInputClick(),this.disabled||this._inputElement.nativeElement.focus()}_preventBubblingFromLabel(e){e.target&&this._labelElement.nativeElement.contains(e.target)&&e.stopPropagation()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=E({type:i,selectors:[["mat-checkbox"]],viewQuery:function(t,n){if(t&1&&(ke(ao,5),ke(ro,5)),t&2){let r;Ce(r=ve())&&(n._inputElement=r.first),Ce(r=ve())&&(n._labelElement=r.first)}},hostAttrs:[1,"mat-mdc-checkbox"],hostVars:16,hostBindings:function(t,n){t&2&&(xi("id",n.id),Je("tabindex",null)("aria-label",null)("aria-labelledby",null),gi(n.color?"mat-"+n.color:"mat-accent"),P("_mat-animation-noopable",n._animationMode==="NoopAnimations")("mdc-checkbox--disabled",n.disabled)("mat-mdc-checkbox-disabled",n.disabled)("mat-mdc-checkbox-checked",n.checked)("mat-mdc-checkbox-disabled-interactive",n.disabledInteractive))},inputs:{ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"],ariaDescribedby:[0,"aria-describedby","ariaDescribedby"],ariaExpanded:[2,"aria-expanded","ariaExpanded",ye],ariaControls:[0,"aria-controls","ariaControls"],ariaOwns:[0,"aria-owns","ariaOwns"],id:"id",required:[2,"required","required",ye],labelPosition:"labelPosition",name:"name",value:"value",disableRipple:[2,"disableRipple","disableRipple",ye],tabIndex:[2,"tabIndex","tabIndex",e=>e==null?void 0:Ti(e)],color:"color",disabledInteractive:[2,"disabledInteractive","disabledInteractive",ye],checked:[2,"checked","checked",ye],disabled:[2,"disabled","disabled",ye],indeterminate:[2,"indeterminate","indeterminate",ye]},outputs:{change:"change",indeterminateChange:"indeterminateChange"},exportAs:["matCheckbox"],features:[Ct([lo,{provide:Yi,useExisting:i,multi:!0}]),ci],ngContentSelectors:so,decls:15,vars:23,consts:[["checkbox",""],["input",""],["label",""],["mat-internal-form-field","",3,"click","labelPosition"],[1,"mdc-checkbox"],[1,"mat-mdc-checkbox-touch-target",3,"click"],["type","checkbox",1,"mdc-checkbox__native-control",3,"blur","click","change","checked","indeterminate","disabled","id","required","tabIndex"],[1,"mdc-checkbox__ripple"],[1,"mdc-checkbox__background"],["focusable","false","viewBox","0 0 24 24","aria-hidden","true",1,"mdc-checkbox__checkmark"],["fill","none","d","M1.73,12.91 8.1,19.28 22.79,4.59",1,"mdc-checkbox__checkmark-path"],[1,"mdc-checkbox__mixedmark"],["mat-ripple","",1,"mat-mdc-checkbox-ripple","mat-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered"],[1,"mdc-label",3,"for"]],template:function(t,n){if(t&1){let r=G();Fe(),u(0,"div",3),S("click",function(a){return O(r),w(n._preventBubblingFromLabel(a))}),u(1,"div",4,0)(3,"div",5),S("click",function(){return O(r),w(n._onTouchTargetClick())}),p(),u(4,"input",6,1),S("blur",function(){return O(r),w(n._onBlur())})("click",function(){return O(r),w(n._onInputClick())})("change",function(a){return O(r),w(n._onInteractionEvent(a))}),p(),V(6,"div",7),u(7,"div",8),li(),u(8,"svg",9),V(9,"path",10),p(),di(),V(10,"div",11),p(),V(11,"div",12),p(),u(12,"label",13,2),Ve(14),p()()}if(t&2){let r=He(2);I("labelPosition",n.labelPosition),b(4),P("mdc-checkbox--selected",n.checked),I("checked",n.checked)("indeterminate",n.indeterminate)("disabled",n.disabled&&!n.disabledInteractive)("id",n.inputId)("required",n.required)("tabIndex",n.disabled&&!n.disabledInteractive?-1:n.tabIndex),Je("aria-label",n.ariaLabel||null)("aria-labelledby",n.ariaLabelledby)("aria-describedby",n.ariaDescribedby)("aria-checked",n.indeterminate?"mixed":null)("aria-controls",n.ariaControls)("aria-disabled",n.disabled&&n.disabledInteractive?!0:null)("aria-expanded",n.ariaExpanded)("aria-owns",n.ariaOwns)("name",n.name)("value",n.value),b(7),I("matRippleTrigger",r)("matRippleDisabled",n.disableRipple||n.disabled)("matRippleCentered",!0),b(),I("for",n.inputId)}},dependencies:[Ae,Tn],styles:['.mdc-checkbox{display:inline-block;position:relative;flex:0 0 18px;box-sizing:content-box;width:18px;height:18px;line-height:0;white-space:nowrap;cursor:pointer;vertical-align:bottom;padding:calc((var(--mdc-checkbox-state-layer-size, 40px) - 18px)/2);margin:calc((var(--mdc-checkbox-state-layer-size, 40px) - var(--mdc-checkbox-state-layer-size, 40px))/2)}.mdc-checkbox:hover>.mdc-checkbox__ripple{opacity:var(--mdc-checkbox-unselected-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity));background-color:var(--mdc-checkbox-unselected-hover-state-layer-color, var(--mat-sys-on-surface))}.mdc-checkbox:hover>.mat-mdc-checkbox-ripple>.mat-ripple-element{background-color:var(--mdc-checkbox-unselected-hover-state-layer-color, var(--mat-sys-on-surface))}.mdc-checkbox .mdc-checkbox__native-control:focus+.mdc-checkbox__ripple{opacity:var(--mdc-checkbox-unselected-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity));background-color:var(--mdc-checkbox-unselected-focus-state-layer-color, var(--mat-sys-on-surface))}.mdc-checkbox .mdc-checkbox__native-control:focus~.mat-mdc-checkbox-ripple .mat-ripple-element{background-color:var(--mdc-checkbox-unselected-focus-state-layer-color, var(--mat-sys-on-surface))}.mdc-checkbox:active>.mdc-checkbox__native-control+.mdc-checkbox__ripple{opacity:var(--mdc-checkbox-unselected-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity));background-color:var(--mdc-checkbox-unselected-pressed-state-layer-color, var(--mat-sys-primary))}.mdc-checkbox:active>.mdc-checkbox__native-control~.mat-mdc-checkbox-ripple .mat-ripple-element{background-color:var(--mdc-checkbox-unselected-pressed-state-layer-color, var(--mat-sys-primary))}.mdc-checkbox:hover .mdc-checkbox__native-control:checked+.mdc-checkbox__ripple{opacity:var(--mdc-checkbox-selected-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity));background-color:var(--mdc-checkbox-selected-hover-state-layer-color, var(--mat-sys-primary))}.mdc-checkbox:hover .mdc-checkbox__native-control:checked~.mat-mdc-checkbox-ripple .mat-ripple-element{background-color:var(--mdc-checkbox-selected-hover-state-layer-color, var(--mat-sys-primary))}.mdc-checkbox .mdc-checkbox__native-control:focus:checked+.mdc-checkbox__ripple{opacity:var(--mdc-checkbox-selected-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity));background-color:var(--mdc-checkbox-selected-focus-state-layer-color, var(--mat-sys-primary))}.mdc-checkbox .mdc-checkbox__native-control:focus:checked~.mat-mdc-checkbox-ripple .mat-ripple-element{background-color:var(--mdc-checkbox-selected-focus-state-layer-color, var(--mat-sys-primary))}.mdc-checkbox:active>.mdc-checkbox__native-control:checked+.mdc-checkbox__ripple{opacity:var(--mdc-checkbox-selected-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity));background-color:var(--mdc-checkbox-selected-pressed-state-layer-color, var(--mat-sys-on-surface))}.mdc-checkbox:active>.mdc-checkbox__native-control:checked~.mat-mdc-checkbox-ripple .mat-ripple-element{background-color:var(--mdc-checkbox-selected-pressed-state-layer-color, var(--mat-sys-on-surface))}.mdc-checkbox--disabled.mat-mdc-checkbox-disabled-interactive .mdc-checkbox .mdc-checkbox__native-control~.mat-mdc-checkbox-ripple .mat-ripple-element,.mdc-checkbox--disabled.mat-mdc-checkbox-disabled-interactive .mdc-checkbox .mdc-checkbox__native-control+.mdc-checkbox__ripple{background-color:var(--mdc-checkbox-unselected-hover-state-layer-color, var(--mat-sys-on-surface))}.mdc-checkbox .mdc-checkbox__native-control{position:absolute;margin:0;padding:0;opacity:0;cursor:inherit;z-index:1;width:var(--mdc-checkbox-state-layer-size, 40px);height:var(--mdc-checkbox-state-layer-size, 40px);top:calc((var(--mdc-checkbox-state-layer-size, 40px) - var(--mdc-checkbox-state-layer-size, 40px))/2);right:calc((var(--mdc-checkbox-state-layer-size, 40px) - var(--mdc-checkbox-state-layer-size, 40px))/2);left:calc((var(--mdc-checkbox-state-layer-size, 40px) - var(--mdc-checkbox-state-layer-size, 40px))/2)}.mdc-checkbox--disabled{cursor:default;pointer-events:none}@media(forced-colors: active){.mdc-checkbox--disabled{opacity:.5}}.mdc-checkbox__background{display:inline-flex;position:absolute;align-items:center;justify-content:center;box-sizing:border-box;width:18px;height:18px;border:2px solid currentColor;border-radius:2px;background-color:rgba(0,0,0,0);pointer-events:none;will-change:background-color,border-color;transition:background-color 90ms cubic-bezier(0.4, 0, 0.6, 1),border-color 90ms cubic-bezier(0.4, 0, 0.6, 1);-webkit-print-color-adjust:exact;color-adjust:exact;border-color:var(--mdc-checkbox-unselected-icon-color, var(--mat-sys-on-surface-variant));top:calc((var(--mdc-checkbox-state-layer-size, 40px) - 18px)/2);left:calc((var(--mdc-checkbox-state-layer-size, 40px) - 18px)/2)}.mdc-checkbox__native-control:enabled:checked~.mdc-checkbox__background,.mdc-checkbox__native-control:enabled:indeterminate~.mdc-checkbox__background{border-color:var(--mdc-checkbox-selected-icon-color, var(--mat-sys-primary));background-color:var(--mdc-checkbox-selected-icon-color, var(--mat-sys-primary))}.mdc-checkbox--disabled .mdc-checkbox__background{border-color:var(--mdc-checkbox-disabled-unselected-icon-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mdc-checkbox__native-control:disabled:checked~.mdc-checkbox__background,.mdc-checkbox__native-control:disabled:indeterminate~.mdc-checkbox__background{background-color:var(--mdc-checkbox-disabled-selected-icon-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent));border-color:rgba(0,0,0,0)}.mdc-checkbox:hover>.mdc-checkbox__native-control:not(:checked)~.mdc-checkbox__background,.mdc-checkbox:hover>.mdc-checkbox__native-control:not(:indeterminate)~.mdc-checkbox__background{border-color:var(--mdc-checkbox-unselected-hover-icon-color, var(--mat-sys-on-surface));background-color:rgba(0,0,0,0)}.mdc-checkbox:hover>.mdc-checkbox__native-control:checked~.mdc-checkbox__background,.mdc-checkbox:hover>.mdc-checkbox__native-control:indeterminate~.mdc-checkbox__background{border-color:var(--mdc-checkbox-selected-hover-icon-color, var(--mat-sys-primary));background-color:var(--mdc-checkbox-selected-hover-icon-color, var(--mat-sys-primary))}.mdc-checkbox__native-control:focus:focus:not(:checked)~.mdc-checkbox__background,.mdc-checkbox__native-control:focus:focus:not(:indeterminate)~.mdc-checkbox__background{border-color:var(--mdc-checkbox-unselected-focus-icon-color, var(--mat-sys-on-surface))}.mdc-checkbox__native-control:focus:focus:checked~.mdc-checkbox__background,.mdc-checkbox__native-control:focus:focus:indeterminate~.mdc-checkbox__background{border-color:var(--mdc-checkbox-selected-focus-icon-color, var(--mat-sys-primary));background-color:var(--mdc-checkbox-selected-focus-icon-color, var(--mat-sys-primary))}.mdc-checkbox--disabled.mat-mdc-checkbox-disabled-interactive .mdc-checkbox:hover>.mdc-checkbox__native-control~.mdc-checkbox__background,.mdc-checkbox--disabled.mat-mdc-checkbox-disabled-interactive .mdc-checkbox .mdc-checkbox__native-control:focus~.mdc-checkbox__background,.mdc-checkbox--disabled.mat-mdc-checkbox-disabled-interactive .mdc-checkbox__background{border-color:var(--mdc-checkbox-disabled-unselected-icon-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mdc-checkbox--disabled.mat-mdc-checkbox-disabled-interactive .mdc-checkbox__native-control:checked~.mdc-checkbox__background,.mdc-checkbox--disabled.mat-mdc-checkbox-disabled-interactive .mdc-checkbox__native-control:indeterminate~.mdc-checkbox__background{background-color:var(--mdc-checkbox-disabled-selected-icon-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent));border-color:rgba(0,0,0,0)}.mdc-checkbox__checkmark{position:absolute;top:0;right:0;bottom:0;left:0;width:100%;opacity:0;transition:opacity 180ms cubic-bezier(0.4, 0, 0.6, 1);color:var(--mdc-checkbox-selected-checkmark-color, var(--mat-sys-on-primary))}@media(forced-colors: active){.mdc-checkbox__checkmark{color:CanvasText}}.mdc-checkbox--disabled .mdc-checkbox__checkmark,.mdc-checkbox--disabled.mat-mdc-checkbox-disabled-interactive .mdc-checkbox__checkmark{color:var(--mdc-checkbox-disabled-selected-checkmark-color, var(--mat-sys-surface))}@media(forced-colors: active){.mdc-checkbox--disabled .mdc-checkbox__checkmark,.mdc-checkbox--disabled.mat-mdc-checkbox-disabled-interactive .mdc-checkbox__checkmark{color:CanvasText}}.mdc-checkbox__checkmark-path{transition:stroke-dashoffset 180ms cubic-bezier(0.4, 0, 0.6, 1);stroke:currentColor;stroke-width:3.12px;stroke-dashoffset:29.7833385;stroke-dasharray:29.7833385}.mdc-checkbox__mixedmark{width:100%;height:0;transform:scaleX(0) rotate(0deg);border-width:1px;border-style:solid;opacity:0;transition:opacity 90ms cubic-bezier(0.4, 0, 0.6, 1),transform 90ms cubic-bezier(0.4, 0, 0.6, 1);border-color:var(--mdc-checkbox-selected-checkmark-color, var(--mat-sys-on-primary))}@media(forced-colors: active){.mdc-checkbox__mixedmark{margin:0 1px}}.mdc-checkbox--disabled .mdc-checkbox__mixedmark,.mdc-checkbox--disabled.mat-mdc-checkbox-disabled-interactive .mdc-checkbox__mixedmark{border-color:var(--mdc-checkbox-disabled-selected-checkmark-color, var(--mat-sys-surface))}.mdc-checkbox--anim-unchecked-checked .mdc-checkbox__background,.mdc-checkbox--anim-unchecked-indeterminate .mdc-checkbox__background,.mdc-checkbox--anim-checked-unchecked .mdc-checkbox__background,.mdc-checkbox--anim-indeterminate-unchecked .mdc-checkbox__background{animation-duration:180ms;animation-timing-function:linear}.mdc-checkbox--anim-unchecked-checked .mdc-checkbox__checkmark-path{animation:mdc-checkbox-unchecked-checked-checkmark-path 180ms linear;transition:none}.mdc-checkbox--anim-unchecked-indeterminate .mdc-checkbox__mixedmark{animation:mdc-checkbox-unchecked-indeterminate-mixedmark 90ms linear;transition:none}.mdc-checkbox--anim-checked-unchecked .mdc-checkbox__checkmark-path{animation:mdc-checkbox-checked-unchecked-checkmark-path 90ms linear;transition:none}.mdc-checkbox--anim-checked-indeterminate .mdc-checkbox__checkmark{animation:mdc-checkbox-checked-indeterminate-checkmark 90ms linear;transition:none}.mdc-checkbox--anim-checked-indeterminate .mdc-checkbox__mixedmark{animation:mdc-checkbox-checked-indeterminate-mixedmark 90ms linear;transition:none}.mdc-checkbox--anim-indeterminate-checked .mdc-checkbox__checkmark{animation:mdc-checkbox-indeterminate-checked-checkmark 500ms linear;transition:none}.mdc-checkbox--anim-indeterminate-checked .mdc-checkbox__mixedmark{animation:mdc-checkbox-indeterminate-checked-mixedmark 500ms linear;transition:none}.mdc-checkbox--anim-indeterminate-unchecked .mdc-checkbox__mixedmark{animation:mdc-checkbox-indeterminate-unchecked-mixedmark 300ms linear;transition:none}.mdc-checkbox__native-control:checked~.mdc-checkbox__background,.mdc-checkbox__native-control:indeterminate~.mdc-checkbox__background{transition:border-color 90ms cubic-bezier(0, 0, 0.2, 1),background-color 90ms cubic-bezier(0, 0, 0.2, 1)}.mdc-checkbox__native-control:checked~.mdc-checkbox__background>.mdc-checkbox__checkmark>.mdc-checkbox__checkmark-path,.mdc-checkbox__native-control:indeterminate~.mdc-checkbox__background>.mdc-checkbox__checkmark>.mdc-checkbox__checkmark-path{stroke-dashoffset:0}.mdc-checkbox__native-control:checked~.mdc-checkbox__background>.mdc-checkbox__checkmark{transition:opacity 180ms cubic-bezier(0, 0, 0.2, 1),transform 180ms cubic-bezier(0, 0, 0.2, 1);opacity:1}.mdc-checkbox__native-control:checked~.mdc-checkbox__background>.mdc-checkbox__mixedmark{transform:scaleX(1) rotate(-45deg)}.mdc-checkbox__native-control:indeterminate~.mdc-checkbox__background>.mdc-checkbox__checkmark{transform:rotate(45deg);opacity:0;transition:opacity 90ms cubic-bezier(0.4, 0, 0.6, 1),transform 90ms cubic-bezier(0.4, 0, 0.6, 1)}.mdc-checkbox__native-control:indeterminate~.mdc-checkbox__background>.mdc-checkbox__mixedmark{transform:scaleX(1) rotate(0deg);opacity:1}@keyframes mdc-checkbox-unchecked-checked-checkmark-path{0%,50%{stroke-dashoffset:29.7833385}50%{animation-timing-function:cubic-bezier(0, 0, 0.2, 1)}100%{stroke-dashoffset:0}}@keyframes mdc-checkbox-unchecked-indeterminate-mixedmark{0%,68.2%{transform:scaleX(0)}68.2%{animation-timing-function:cubic-bezier(0, 0, 0, 1)}100%{transform:scaleX(1)}}@keyframes mdc-checkbox-checked-unchecked-checkmark-path{from{animation-timing-function:cubic-bezier(0.4, 0, 1, 1);opacity:1;stroke-dashoffset:0}to{opacity:0;stroke-dashoffset:-29.7833385}}@keyframes mdc-checkbox-checked-indeterminate-checkmark{from{animation-timing-function:cubic-bezier(0, 0, 0.2, 1);transform:rotate(0deg);opacity:1}to{transform:rotate(45deg);opacity:0}}@keyframes mdc-checkbox-indeterminate-checked-checkmark{from{animation-timing-function:cubic-bezier(0.14, 0, 0, 1);transform:rotate(45deg);opacity:0}to{transform:rotate(360deg);opacity:1}}@keyframes mdc-checkbox-checked-indeterminate-mixedmark{from{animation-timing-function:cubic-bezier(0, 0, 0.2, 1);transform:rotate(-45deg);opacity:0}to{transform:rotate(0deg);opacity:1}}@keyframes mdc-checkbox-indeterminate-checked-mixedmark{from{animation-timing-function:cubic-bezier(0.14, 0, 0, 1);transform:rotate(0deg);opacity:1}to{transform:rotate(315deg);opacity:0}}@keyframes mdc-checkbox-indeterminate-unchecked-mixedmark{0%{animation-timing-function:linear;transform:scaleX(1);opacity:1}32.8%,100%{transform:scaleX(0);opacity:0}}.mat-mdc-checkbox{display:inline-block;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-checkbox._mat-animation-noopable>.mat-internal-form-field>.mdc-checkbox>.mat-mdc-checkbox-touch-target,.mat-mdc-checkbox._mat-animation-noopable>.mat-internal-form-field>.mdc-checkbox>.mdc-checkbox__native-control,.mat-mdc-checkbox._mat-animation-noopable>.mat-internal-form-field>.mdc-checkbox>.mdc-checkbox__ripple,.mat-mdc-checkbox._mat-animation-noopable>.mat-internal-form-field>.mdc-checkbox>.mat-mdc-checkbox-ripple::before,.mat-mdc-checkbox._mat-animation-noopable>.mat-internal-form-field>.mdc-checkbox>.mdc-checkbox__background,.mat-mdc-checkbox._mat-animation-noopable>.mat-internal-form-field>.mdc-checkbox>.mdc-checkbox__background>.mdc-checkbox__checkmark,.mat-mdc-checkbox._mat-animation-noopable>.mat-internal-form-field>.mdc-checkbox>.mdc-checkbox__background>.mdc-checkbox__checkmark>.mdc-checkbox__checkmark-path,.mat-mdc-checkbox._mat-animation-noopable>.mat-internal-form-field>.mdc-checkbox>.mdc-checkbox__background>.mdc-checkbox__mixedmark{transition:none !important;animation:none !important}.mat-mdc-checkbox label{cursor:pointer}.mat-mdc-checkbox .mat-internal-form-field{color:var(--mat-checkbox-label-text-color, var(--mat-sys-on-surface));font-family:var(--mat-checkbox-label-text-font, var(--mat-sys-body-medium-font));line-height:var(--mat-checkbox-label-text-line-height, var(--mat-sys-body-medium-line-height));font-size:var(--mat-checkbox-label-text-size, var(--mat-sys-body-medium-size));letter-spacing:var(--mat-checkbox-label-text-tracking, var(--mat-sys-body-medium-tracking));font-weight:var(--mat-checkbox-label-text-weight, var(--mat-sys-body-medium-weight))}.mat-mdc-checkbox.mat-mdc-checkbox-disabled.mat-mdc-checkbox-disabled-interactive{pointer-events:auto}.mat-mdc-checkbox.mat-mdc-checkbox-disabled.mat-mdc-checkbox-disabled-interactive input{cursor:default}.mat-mdc-checkbox.mat-mdc-checkbox-disabled label{cursor:default;color:var(--mat-checkbox-disabled-label-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-mdc-checkbox label:empty{display:none}.mat-mdc-checkbox .mdc-checkbox__ripple{opacity:0}.mat-mdc-checkbox .mat-mdc-checkbox-ripple,.mdc-checkbox__ripple{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:50%;pointer-events:none}.mat-mdc-checkbox .mat-mdc-checkbox-ripple:not(:empty),.mdc-checkbox__ripple:not(:empty){transform:translateZ(0)}.mat-mdc-checkbox-ripple .mat-ripple-element{opacity:.1}.mat-mdc-checkbox-touch-target{position:absolute;top:50%;left:50%;height:48px;width:48px;transform:translate(-50%, -50%);display:var(--mat-checkbox-touch-target-display, block)}.mat-mdc-checkbox .mat-mdc-checkbox-ripple::before{border-radius:50%}.mdc-checkbox__native-control:focus~.mat-focus-indicator::before{content:""}'],encapsulation:2,changeDetection:0})}return i})();var On=(()=>{class i{static \u0275fac=function(t){return new(t||i)};static \u0275mod=Rt({type:i});static \u0275inj=It({imports:[Ot,Ut,Ut]})}return i})();var wt=(()=>{class i{constructor(){k.getInstance().watchEvents(_.COMPLETE_TIMED_PAUSE,()=>this.timedPauseBuilding=void 0)}setTimedPauseBuilding(e){this.hasOtherBuildingTimedPause(e)&&this.clearTimedPauseBuilding(this.timedPauseBuilding),this.timedPauseBuilding=e,e.timedPause=!0}clearTimedPauseBuilding(e){this.timedPauseBuilding=void 0,e.timedPause=!1}hasOtherBuildingTimedPause(e){return!!this.timedPauseBuilding&&this.timedPauseBuilding!==e}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=ut({token:i,factory:i.\u0275fac})}}return i})();var ho=["checkbox"],uo=["*"],lt=(()=>{class i{constructor(){this.contextMenuService=C(wt),this.cdr=C(ze),this.building=U.required(),k.getInstance().watchEvents(_.COMPLETE_TIMED_PAUSE,()=>this.cdr.markForCheck())}onTimedPauseChange(e){e.checked?this.contextMenuService.setTimedPauseBuilding(this.building()):this.contextMenuService.clearTimedPauseBuilding(this.building()),this.inputElement.blur()}get timedPauseWarning(){return this.contextMenuService.hasOtherBuildingTimedPause(this.building())}get inputElement(){return this.checkboxElementRef.nativeElement.querySelector("input[type='checkbox']")}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=E({type:i,selectors:[["rd-timed-pause-widget"]],viewQuery:function(t,n){if(t&1&&ke(ho,5,be),t&2){let r;Ce(r=ve())&&(n.checkboxElementRef=r.first)}},inputs:{building:[1,"building"]},ngContentSelectors:uo,decls:5,vars:3,consts:[["checkbox",""],[3,"change","checked"],[1,"warning"]],template:function(t,n){if(t&1){let r=G();Fe(),u(0,"mat-checkbox",1,0),S("change",function(a){return O(r),w(n.onTimedPauseChange(a))}),Ve(2),p(),u(3,"span",2),x(4,` Other building has a timed pause turned on. If you turn this on, the other's will be turned off.
`),p()}t&2&&(I("checked",n.building().timedPause),b(3),P("invisible",!n.timedPauseWarning))},dependencies:[On,Ot],styles:["mat-checkbox[_ngcontent-%COMP%]{margin-left:-11px}.warning[_ngcontent-%COMP%]{display:block;text-wrap:wrap;max-width:18rem;font-size:.75rem;color:var(--rd-warn)}.warning.invisible[_ngcontent-%COMP%]{visibility:hidden}"],changeDetection:0})}}return i})();function po(i,o){if(i&1){let e=G();u(0,"button",3,0),S("click",function(){let n=O(e).$implicit,r=He(1);return A().delaySpawn(n),w(r.blur())}),x(2),p()}if(i&2){let e=o.$implicit;b(2),X(" ",e,"s ")}}var wn=(()=>{class i{constructor(){this.spawnDelayTimes=[.5,1],this.building=U.required()}delaySpawn(e){this.building().delaySpawn(e)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=E({type:i,selectors:[["rd-spawner-context-menu"]],inputs:{building:[1,"building"]},decls:14,vars:7,consts:[["button",""],["matRipple","",1,"delay-button"],[3,"building"],["matRipple","",1,"delay-button",3,"click"]],template:function(t,n){t&1&&(u(0,"h3"),x(1,"Spawner"),p(),u(2,"p"),x(3),ue(4,"async"),p(),u(5,"p"),x(6),ue(7,"async"),p(),u(8,"p"),x(9," Delay spawn by: "),et(10,po,3,1,"button",1,bt),p(),u(12,"rd-timed-pause-widget",2),x(13,"Pause the game when it spawns"),p()),t&2&&(b(3),X("Cars spawned: ",pe(4,3,n.building().displayCarsSpawned$),""),b(3),X("Spawns car in: ",pe(7,5,n.building().displayTimer$),""),b(4),tt(n.spawnDelayTimes),b(2),I("building",n.building()))},dependencies:[We,Ae,lt],styles:["[_nghost-%COMP%]{-webkit-user-select:none;user-select:none}h3[_ngcontent-%COMP%]{margin:0 0 1rem;color:var(--rd-primary-darker)}button[_ngcontent-%COMP%]{font-size:.875rem;border:1px solid black;border-radius:.5rem;outline:none;background-color:var(--rd-white);height:2rem;text-align:center;cursor:pointer}p[_ngcontent-%COMP%]{margin-block:0 .5rem}.delay-button[_ngcontent-%COMP%]{width:2.5rem;padding-inline:0}.delay-button[_ngcontent-%COMP%]:first-child{margin-left:.5rem}.delay-button[_ngcontent-%COMP%]:not(:first-child){border-top-left-radius:unset;border-bottom-left-radius:unset}.delay-button[_ngcontent-%COMP%]:not(:last-child){border-top-right-radius:unset;border-bottom-right-radius:unset}"],changeDetection:0})}}return i})();var Sn=(()=>{class i{constructor(){this.building=U.required(),this.isGateClosed=Z(()=>this.building().isClosed())}switchGateState(){this.building().switch()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=E({type:i,selectors:[["rd-timed-gate-context-menu"]],inputs:{building:[1,"building"]},decls:15,vars:5,consts:[["button",""],[1,"state-control-container"],["matRipple","",3,"click"],[3,"building"]],template:function(t,n){if(t&1){let r=G();u(0,"h3"),x(1,"Timed Gate"),p(),u(2,"div",1)(3,"p"),x(4," Current state: "),u(5,"strong"),x(6),p()(),u(7,"p"),x(8),ue(9,"async"),p(),u(10,"button",2,0),S("click",function(){O(r);let a=He(11);return n.switchGateState(),w(a.blur())}),x(12," Switch state "),p()(),u(13,"rd-timed-pause-widget",3),x(14,"Pause the game when it switches"),p()}t&2&&(b(6),le(n.isGateClosed()?"closed":"open"),b(2),X("Switches state in ",pe(9,3,n.building().displayTimer$),"s"),b(5),I("building",n.building()))},dependencies:[Ae,We,lt],styles:["[_nghost-%COMP%]{-webkit-user-select:none;user-select:none}h3[_ngcontent-%COMP%]{margin:0 0 1rem;color:var(--rd-primary-darker)}button[_ngcontent-%COMP%]{font-size:.875rem;border:1px solid black;border-radius:.5rem;outline:none;background-color:var(--rd-white);height:2rem;text-align:center;cursor:pointer}.state-control-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-block:.25rem}.state-control-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:last-of-type{margin-bottom:.5rem}.state-control-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding-inline:1rem}"],changeDetection:0})}}return i})();var In={[ct.SPAWNER]:{component:wn,buildingType:ot},[ct.TIMED_GATE]:{component:Sn,buildingType:we},[ct.DESTINATION]:{component:yn,buildingType:ne}};var fo=i=>({building:i});function go(i,o){i&1&&bi(0)}function _o(i,o){if(i&1&&F(0,go,1,0,"ng-container",0),i&2){let e=A();I("ngComponentOutlet",e.contextMenuComponent())("ngComponentOutletInputs",vi(2,fo,e.contextMenuBuilding()))}}var An=(()=>{class i{constructor(){this.elementRef=C(be),this.widthRem=18,this.contextMenuBuilding=U(),this.contextMenuComponent=Z(()=>{let[e,t]=Object.entries(In).find(([n,r])=>this.contextMenuBuilding()instanceof r.buildingType)??[];return e===void 0||t===void 0?null:t.component}),this.isOnBottom=Z(()=>{let e=this.contextMenuBuilding();return e?this.calcIsOnBottom(e):!1}),this.xPos=Z(()=>{let e=this.contextMenuBuilding();if(!e)return"0px";let t=this.calcIsOnLeft(e),n=e.tile.x+(t?2:-1),r=Math.min(c.COLUMN_COUNT,Math.max(0,n)),s=c.unit(r)+(t?-Ee.remToPx(Ee.CANVAS_BORDER_WIDTH_REM):0);return t?`calc(${s}px - ${this.widthRem}rem)`:`${s}px`}),this.yPosPx=Z(()=>{let e=this.contextMenuBuilding();return e?c.unit(e.tile.y)+Ee.remToPx(Ee.CANVAS_BORDER_WIDTH_REM)+(this.calcIsOnBottom(e)?c.unit():0):0}),mt(document,"mousedown").pipe(Te(),ce(e=>e.target),te(e=>e instanceof HTMLElement),te(e=>!this.isChildOfThis(e))).subscribe(()=>k.getInstance().emitEvent(_.CLOSE_CONTEXT_MENU,null))}isChildOfThis(e){return!e||e===document.body?!1:e===this.elementRef.nativeElement?!0:this.isChildOfThis(e.parentElement)}calcIsOnBottom(e){return e.tile.y<c.ROW_COUNT/2}calcIsOnLeft(e){return e.tile.x>c.COLUMN_COUNT/2}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=E({type:i,selectors:[["rd-context-menu"]],hostVars:10,hostBindings:function(t,n){t&2&&(fi("left",n.xPos())("top",n.yPosPx(),"px")("width",n.widthRem,"rem"),P("visible",n.contextMenuBuilding()&&n.contextMenuComponent())("is-on-bottom",n.isOnBottom()))},inputs:{contextMenuBuilding:[1,"contextMenuBuilding"]},features:[Ct([wt])],decls:1,vars:1,consts:[[4,"ngComponentOutlet","ngComponentOutletInputs"]],template:function(t,n){t&1&&F(0,_o,1,4,"ng-container"),t&2&&q(n.contextMenuBuilding()?0:-1)},dependencies:[wi],styles:["[_nghost-%COMP%]{--translate-x: 0;--translate-y: -100%;position:absolute;display:block;visibility:hidden;translate:var(--translate-x) var(--translate-y);background-color:var(--rd-primary-lighter);border:2px solid var(--rd-primary-darker);border-radius:1rem;padding:1rem}@supports (interpolate-size: allow-keywords){[_nghost-%COMP%]{height:0;interpolate-size:allow-keywords;overflow-y:hidden;transition:height .25s ease}.visible[_nghost-%COMP%]{height:auto}}@supports not (interpolate-size: allow-keywords){[_nghost-%COMP%]{opacity:0;transition:opacity .35s ease}.visible[_nghost-%COMP%]{opacity:1}}.is-on-bottom[_nghost-%COMP%]{--translate-y: 0}.visible[_nghost-%COMP%]{visibility:visible}"],changeDetection:0})}}return i})();var bo=["gameCanvas"],Kt=(()=>{class i{constructor(){this.gameStatus=U.required(),this.seed=U.required(),this.gameCanvas=_t("gameCanvas"),this.contextMenuBuilding=xe(void 0),k.getInstance().watchEvents(_.OPEN_CONTEXT_MENU,e=>this.contextMenuBuilding.set(e)),k.getInstance().watchEvents(_.CLOSE_CONTEXT_MENU,()=>this.contextMenuBuilding.set(void 0)),Ei(()=>{let e=this.gameCanvas();if(!e||this.game)return;document.addEventListener("contextmenu",n=>{n.preventDefault()},!1);let t=e.nativeElement;D.registerSeed(this.seed()),this.game=new vn(t,this.gameStatus),this.onResizeFn=()=>{c.resize(),t.style.width=(t.width=c.unit(c.COLUMN_COUNT))+"px",t.style.height=(t.height=c.unit(c.ROW_COUNT))+"px",this.game.onResize()},window.addEventListener("resize",this.onResizeFn),this.onResizeFn(),this.startGame()})}ngOnDestroy(){this.game?.stop(),this.onResizeFn&&window.removeEventListener("resize",this.onResizeFn)}startGame(){k.getInstance().emitEvent(_.START_GAME,null),this.game.startGame()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=E({type:i,selectors:[["rd-game-area"]],viewQuery:function(t,n){t&1&&xt(n.gameCanvas,bo,5),t&2&&kt()},inputs:{gameStatus:[1,"gameStatus"],seed:[1,"seed"]},decls:3,vars:3,consts:[["gameCanvas",""],[3,"contextMenuBuilding"]],template:function(t,n){t&1&&V(0,"canvas",null,0)(2,"rd-context-menu",1),t&2&&(P("active",n.gameStatus().isGameGoing),b(2),I("contextMenuBuilding",n.contextMenuBuilding()))},dependencies:[An],styles:["[_nghost-%COMP%]{display:block;position:relative;width:fit-content}canvas[_ngcontent-%COMP%]{display:block;border:.5rem solid var(--rd-black);border-radius:1rem;aspect-ratio:2/1}canvas.active[_ngcontent-%COMP%]{cursor:pointer}"],changeDetection:0})}}return i})();var Qt=(()=>{class i extends Ki{static{this.EARLY_GAME_END_SCORE=750}constructor(e){super(Di.GAME),this.getScoreFn=e,this.earlyGameSongs=this.findSongsByTag(Nt.EARLY_GAME),this.lateGameSongs=this.findSongsByTag(Nt.LATE_GAME)}chooseNextSong(e){return this.isEarlyGame()?this.getRandomSong(e,this.earlyGameSongs):this.getRandomSong(e,this.lateGameSongs)}isEarlyGame(){return this.getScoreFn()<i.EARLY_GAME_END_SCORE}}return i})();var Jt=(()=>{class i{transform(e){return e.isPaused?0:e.gameSpeed}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275pipe=pi({name:"calculateTrueGameSpeed",type:i,pure:!0})}}return i})();var xo=["iconCanvas"];function ko(i,o){i&1&&(u(0,"mat-icon"),x(1,"build"),p())}function Co(i,o){i&1&&V(0,"canvas",null,0)}var Dn=(()=>{class i{constructor(){this.item=U.required(),this.isEditorTool=Z(()=>this.item().selection===L.EDITOR_TOOL),this.iconCanvas=_t("iconCanvas");let e=it(this.iconCanvas);it(this.item).pipe(oi(t=>e.pipe(te(Boolean),ce(n=>t.selection===L.ROAD||t.selection===L.TUBE?[[t.factory(this.createMockTile(0,.5)),t.factory(this.createMockTile(1,.5))],n.nativeElement]:[[t.factory(this.createMockTile())],n.nativeElement]))),Te()).subscribe(([t,n])=>{this.initCanvas(n,t.length);let r=new Ge(n);t.forEach(s=>{this.initBuilding(s),s.draw(r)})})}initCanvas(e,t){e.height=e.width=c.unit(t)}initBuilding(e){e instanceof we&&e.switch()}createMockTile(e=0,t=0){return{x:e,y:t,isConnectedWithRoad:n=>n===H.RIGHT&&e===0||n===H.LEFT&&e===1}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=E({type:i,selectors:[["rd-toolbar-icon"]],viewQuery:function(t,n){t&1&&xt(n.iconCanvas,xo,5),t&2&&kt()},inputs:{item:[1,"item"]},decls:2,vars:1,consts:[["iconCanvas",""]],template:function(t,n){t&1&&F(0,ko,2,0,"mat-icon")(1,Co,2,0,"canvas"),t&2&&q(n.isEditorTool()?0:1)},dependencies:[zi,Hi],styles:["[_nghost-%COMP%]{display:grid;place-items:center;width:2.8rem;aspect-ratio:1}mat-icon[_ngcontent-%COMP%]{font-size:1.75rem;height:unset;width:unset}canvas[_ngcontent-%COMP%]{width:100%;aspect-ratio:1}"],changeDetection:0})}}return i})();function vo(i,o){if(i&1){let e=G();u(0,"button",6),S("click",function(){let n=O(e).$index,r=A(3);return w(r.selectTool(n))}),u(1,"span",7),x(2),p(),V(3,"rd-toolbar-icon",8),p()}if(i&2){let e=o.$implicit,t=o.$index,n=A(3);P("selected",n.gameStatus().selectedToolbarItem===t),b(2),le(t),b(),I("item",e)("matTooltip",e.displayName)}}function yo(i,o){if(i&1&&(u(0,"div",1),et(1,vo,4,5,"button",5,_i),p()),i&2){let e=A(2);b(),tt(e.gameToolbar().items)}}function To(i,o){if(i&1){let e=G();u(0,"div",9),ue(1,"calculateTrueGameSpeed"),S("click",function(){let n=O(e).$implicit,r=A(2);return w(r.setGameSpeed(n))}),x(2),p()}if(i&2){let e=o.$implicit,t=A(2);P("selected",pe(1,3,t.gameStatus())===e),b(2),X(" x",e," ")}}function Eo(i,o){if(i&1&&(u(0,"p",0),x(1),p(),F(2,yo,3,0,"div",1),V(3,"rd-music-controller",2),u(4,"div",3),et(5,To,3,5,"div",4,bt),p()),i&2){let e=A();ki("matTooltip","New buildings spawn in ",e.gameStatus().spawnTimer," seconds"),b(),X(" Score: ",e.gameStatus().score," "),b(),q(e.gameToolbar()?2:-1),b(),I("handler",e.musicHandler),b(2),tt(e.possibleGameSpeeds)}}function Mo(i,o){i&1&&(u(0,"p",10),x(1,"Victory!"),p())}function Oo(i,o){i&1&&(u(0,"p",11),x(1,"Game Over!"),p())}function wo(i,o){if(i&1){let e=G();F(0,Mo,2,0,"p",10)(1,Oo,2,0,"p",11),u(2,"button",12),S("click",function(){O(e);let n=A();return w(n.openEndOfGameDialog.emit())}),x(3," Open end of game dialog "),p()}if(i&2){let e=A();q(e.gameStatus().isVictory?0:1)}}var ei=(()=>{class i{constructor(){this.gameStatus=U.required(),this.gameSpeedChange=Dt(),this.openEndOfGameDialog=Dt(),this.possibleGameSpeeds=[0,1,2,4,8],this.possibleGameSpeedKeys=["q","w","e","r"],this.gameToolbar=oe.inject(),this.musicHandler=new Qt(Z(()=>this.gameStatus().score)),mt(document,"keydown").pipe(Te(),ce(e=>e.key),te(e=>this.possibleGameSpeedKeys.includes(e))).subscribe(e=>this.setGameSpeed(this.possibleGameSpeeds[this.possibleGameSpeedKeys.indexOf(e)+1]))}selectTool(e){this.gameToolbar().selectItemByKey(e)}setGameSpeed(e){this.gameSpeedChange.emit(e)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=E({type:i,selectors:[["rd-toolbar"]],hostVars:2,hostBindings:function(t,n){t&2&&P("game-over",!n.gameStatus().isGameGoing)},inputs:{gameStatus:[1,"gameStatus"]},outputs:{gameSpeedChange:"gameSpeedChange",openEndOfGameDialog:"openEndOfGameDialog"},decls:2,vars:1,consts:[[1,"score",3,"matTooltip"],[1,"toolbar-items-container"],[3,"handler"],[1,"game-speed-panel"],[1,"game-speed-button",3,"selected"],["mat-fab","",1,"toolbar-item",3,"selected"],["mat-fab","",1,"toolbar-item",3,"click"],[1,"toolbar-item-key"],[3,"item","matTooltip"],[1,"game-speed-button",3,"click"],[1,"victory"],[1,"defeat"],["mat-flat-button","","color","accent",1,"end-of-game-button",3,"click"]],template:function(t,n){t&1&&F(0,Eo,7,5)(1,wo,4,1),t&2&&q(n.gameStatus().isGameGoing?0:1)},dependencies:[ji,qi,qe,Jt,Dn,Xi],styles:['[_nghost-%COMP%]{position:relative;display:grid;grid-template-columns:1fr auto 1fr;gap:1rem;align-items:center;background-color:var(--rd-primary);padding-inline:1rem;-webkit-user-select:none;user-select:none}.game-over[_nghost-%COMP%]{justify-content:center;gap:3rem}p[_ngcontent-%COMP%]{margin:0}.score[_ngcontent-%COMP%]{display:block;font-size:2.5rem;min-width:max-content;-webkit-user-select:none;user-select:none}.toolbar-items-container[_ngcontent-%COMP%]{display:flex;gap:.25rem}.toolbar-items-container[_ngcontent-%COMP%]   .toolbar-item[_ngcontent-%COMP%]{position:relative;font-size:1.25rem;margin:.75rem;box-shadow:none}.toolbar-items-container[_ngcontent-%COMP%]   .toolbar-item.selected[_ngcontent-%COMP%]:after{content:"";position:absolute;left:0;bottom:-.75rem;width:100%;height:.5rem;background-color:var(--rd-accent-darker);border-radius:.25rem}.toolbar-items-container[_ngcontent-%COMP%]   .toolbar-item.selected[_ngcontent-%COMP%]   .toolbar-item-key[_ngcontent-%COMP%]{color:var(--rd-accent-darker);font-weight:700}.toolbar-items-container[_ngcontent-%COMP%]   .toolbar-item[_ngcontent-%COMP%]   .toolbar-item-key[_ngcontent-%COMP%]{position:absolute;top:0;left:0;translate:-80% -80%;font-size:2rem;color:var(--rd-accent-disabled);margin-right:1rem}rd-music-controller[_ngcontent-%COMP%]{width:clamp(15rem,100%,22rem);justify-self:center}.game-speed-panel[_ngcontent-%COMP%]{position:absolute;top:100%;z-index:1;background-color:inherit;padding:.5rem;left:0;border-bottom-right-radius:.5rem;opacity:1;transition:opacity .2s ease}.game-speed-panel[_ngcontent-%COMP%]:hover{opacity:.5}.game-speed-panel[_ngcontent-%COMP%]   .game-speed-button[_ngcontent-%COMP%]{display:inline-block;font:1rem monospace;color:var(--rd-white);background-color:var(--rd-accent);border:none;aspect-ratio:1;padding:.5rem;border-radius:50%;transition:background-color .4s ease}.game-speed-panel[_ngcontent-%COMP%]   .game-speed-button.selected[_ngcontent-%COMP%]{background-color:var(--rd-accent-darker)}.game-speed-panel[_ngcontent-%COMP%]   .game-speed-button[_ngcontent-%COMP%]:not(.selected){cursor:pointer}.game-speed-panel[_ngcontent-%COMP%]   .game-speed-button[_ngcontent-%COMP%]:focus-visible{outline:none}.game-speed-panel[_ngcontent-%COMP%]   .game-speed-button[_ngcontent-%COMP%] + .game-speed-button[_ngcontent-%COMP%]{margin-left:.25rem}p.defeat[_ngcontent-%COMP%], p.victory[_ngcontent-%COMP%]{font-size:3rem;font-weight:500}p.defeat[_ngcontent-%COMP%]{color:var(--rd-warn)}p.victory[_ngcontent-%COMP%]{color:var(--rd-primary-darker)}.end-of-game-button[_ngcontent-%COMP%]{font-size:1.5rem;height:3.625rem;flex-basis:14rem}'],changeDetection:0})}}return i})();var So=(i,o,e)=>({defeat:i,victory:o,paused:e}),Fd=(()=>{class i{static{this.BUILDING_SPAWN_MESSAGE_TIME=10}constructor(){this.snackbar=C(tn),this.dialog=C(Vi),this.gameStartService=C(Zi),this.storageService=C(Ii),this.isNewBest=!1,this.seed=this.getSeed();let e=this.storageService.read(je.GAME_SPEED);this.gameStatus=xe({isGameGoing:!1,isVictory:!1,isPaused:e>2,gameSpeed:e,selectedToolbarItem:0,score:0,spawnTimer:0}),k.getInstance().watchEvents(_.START_GAME,()=>this.gameStatus.update(t=>me(W({},t),{isGameGoing:!0}))),k.getInstance().watchEvents(_.TOGGLE_PAUSE,()=>this.gameStatus.update(t=>me(W({},t),{isPaused:!t.isPaused}))),k.getInstance().watchEvents(_.SELECT_TOOLBAR_ITEM,t=>this.gameStatus.update(n=>me(W({},n),{selectedToolbarItem:t}))),k.getInstance().watchEvents(_.GAIN_SCORE,()=>this.gameStatus.update(t=>me(W({},t),{score:t.score+1}))),k.getInstance().watchEvents(_.UPDATE_SPAWN_TIMER,t=>{this.gameStatus().spawnTimer>i.BUILDING_SPAWN_MESSAGE_TIME&&t<=i.BUILDING_SPAWN_MESSAGE_TIME&&this.openSnackbarMessage(`New spawner and destination spawns in ${t} seconds`,"Understood"),this.gameStatus.update(n=>me(W({},n),{spawnTimer:t}))}),k.getInstance().watchEvents(_.DESTINATION_CRITICAL_HEALTH,t=>{this.openSnackbarMessage(`One of your destinations has ${t} health!`,"I'll fix it!")}),k.getInstance().watchEvents(_.GAME_OVER,t=>this.gameStatus.update(n=>me(W({},n),{isGameGoing:!1,isVictory:t}))),it(this.gameStatus).pipe(ce(t=>t.isGameGoing),ii(),te(([t,n])=>t!==n&&!n),Te()).subscribe(()=>this.onEndOfGame())}onGameSpeedChange(e){if(e===0&&!this.gameStatus().isPaused){k.getInstance().emitEvent(_.TOGGLE_PAUSE,null);return}e!==0&&(this.gameStatus().isPaused&&k.getInstance().emitEvent(_.TOGGLE_PAUSE,null),this.gameStatus.update(t=>me(W({},t),{gameSpeed:e})),this.storageService.save(je.GAME_SPEED,e))}onEndOfGame(){let e=this.gameStatus().score;e>this.storageService.read(je.PERSONAL_BEST).score&&(this.storageService.save(je.PERSONAL_BEST,{score:e,timestamp:Date.now()}),this.isNewBest=!0),this.openEndOfGameDialog()}openEndOfGameDialog(){let e={score:this.gameStatus().score,best:this.storageService.read(je.PERSONAL_BEST).score,isNewBest:this.isNewBest,isVictory:this.gameStatus().isVictory,seed:this.seed};this.dialog.open(Cn,{data:e})}openSnackbarMessage(e,t){this.snackbar.open(e,t,{duration:3e3})}getSeed(){let e=this.gameStartService.getStartingParams().seed;return e||Math.random().toString()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=E({type:i,selectors:[["rd-game"]],decls:4,vars:8,consts:[[3,"gameSpeedChange","openEndOfGameDialog","gameStatus"],[1,"game-area-wrapper",3,"ngClass"],[3,"gameStatus","seed"]],template:function(t,n){if(t&1){let r=G();Ci(0),u(1,"rd-toolbar",0),S("gameSpeedChange",function(a){return O(r),w(n.onGameSpeedChange(a))})("openEndOfGameDialog",function(){return O(r),w(n.openEndOfGameDialog())}),p(),u(2,"div",1),V(3,"rd-game-area",2),p()}if(t&2){let r=n.gameStatus();b(),I("gameStatus",r),b(),I("ngClass",yi(4,So,!r.isGameGoing&&!r.isVictory,!r.isGameGoing&&r.isVictory,r.isPaused)),b(),I("gameStatus",r)("seed",n.seed)}},dependencies:[ei,Oi,Kt],styles:["[_nghost-%COMP%]{display:grid;grid-template-rows:7.5rem 1fr;height:100dvh}[_nghost-%COMP%] > *[_ngcontent-%COMP%]{max-width:100dvw}.game-area-wrapper[_ngcontent-%COMP%]{background-color:var(--rd-accent-lighter);display:grid;place-items:center}.game-area-wrapper.paused[_ngcontent-%COMP%]{background-color:var(--rd-accent-disabled)}.game-area-wrapper.defeat[_ngcontent-%COMP%]{background-color:var(--rd-warn)}.game-area-wrapper.victory[_ngcontent-%COMP%]{background-color:var(--rd-white)}"],changeDetection:0})}}return i})();export{Fd as GameComponent};
